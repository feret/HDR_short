\newcommand{\steppopgraph}{}
\newcommand{\statepopgraph}{}
\newcommand{\fwdflowpop}{}
\newcommand{\bwdflowpop}{}
\newcommand{\activitygraphpop}{}
\newcommand{\fwdflowpopbis}{}
\newcommand{\rlongiso}{}
\newcommand{\flowpop}{}
\newcommand{\inclusion}{}
\newcommand{\labelindivgraph}{}
\newcommand{\slightequiv}{a}
\newcommand{\allocgraph}{}
\newcommand{\allocgraphshort}{}
\newcommand{\equivmodel}{}
%\newcommand{\conc}[1]{[#1]}
\newcommand{\pone}{\agentfont{A}}
\newcommand{\ptwo}[2]{\agentfont{A}.\sitefont{#1}-\sitefont{#2}.\agentfont{A}}
\newcommand{\pxx}{\ptwo{x}{x}}
\newcommand{\pxy}{\ptwo{x}{y}}
\newcommand{\pyy}{\ptwo{y}{y}}

\newcommand{\actionmap}{}
\newcommand{\stateindivgraph}{}
\newcommand{\activitygraphindiv}{}
\newcommand{\fwdflowindiv}{}
\newcommand{\bwdflowindiv}{}
\newcommand{\labelpopgraph}{}
\newcommand{\flowindiv}{}
\newcommand{\isoL}{}
\newcommand{\isoR}{}
\newcommand{\bothsite}{}
\newcommand{\symsymbol}{}
\newcommand{\graphsymb}{}
\newcommand{\ext}{}
\newcommand{\emptylist}{}
\newcommand{\stepindivgraph}{}
\newcommand{\dummy}{{}}
\newcommand{\st}{tel que}\newcommand{\sitename}{}
\newcommand{\statename}{}
\newcommand{\statesite}{}
\newcommand{\linksite}{}
\newcommand{\graphtuple}{}
\newcommand{\sites}{}
\newcommand{\links}{}
\newcommand{\props}{}
\newcommand{\groupequiv}{}
\newcommand{\im}{}
\newcommand{\identity}{}
\newcommand{\lonweakembedding}{}
\newcommand{\rlongweakembedding}{}
\newcommand{\actioncomposeweakemblong}{}
\newcommand{\csize}{1cm}
\newcommand{\rsize}{1cm}
\newcommand{\incbox}[3]{\begin{minipage}{#2}\includegraphics[width=#2,height=#1]{#3}\end{minipage}}
%\newcommand{\myfrac}[2]{\frac{\strut #1}{\strut #2}}
\newcommand{\smallfrac}[2]{\frac{\scriptstyle #1}{\scriptstyle #2}}
\renewcommand{\incbox}[3]{\scalebox{\scalefactor}{\includegraphics{#3}}}
\newcommand{\scaleladot}{1}
\newcommand{\probsymb}{P}
\newcommand{\funstyle}[1]{\mathrm{#1}}
\newcommand{\activity}[1]{\funstyle{a}(#1)}
\newcommand{\llongembedding}{}
\newcommand{\rlongembedding}{}
\newcommand{\lvlongembedding}{}
\newcommand{\rvlongembedding}{}
\newcommand{\lvvlongembedding}{}
\newcommand{\rvvlongembedding}{}
\newcommand{\lvvvlongembedding}{}
\newcommand{\rvvvlongembedding}{}
\newcommand{\llongweakembedding}{}
\newcommand{\lvlongweakembedding}{}
\newcommand{\actionpartialemblong}{}
\newcommand{\actionpartialembactionlong}{}
\newcommand{\rvlongweakembedding}{}
\newcommand{\lvvlongweakembedding}{}
\newcommand{\rvvlongweakembedding}{}
\newcommand{\symrules}{}
\newcommand{\pullbackcorner}{}
\newcommand{\eg}{e.g.~}
\newcommand{\ie}{i.e.~}
\newcommand{\notgroupequiv}{}
\newcommand{\suchthat}{tel que}
\newcommand{\uminus}{ - }
\newcommand{\kapparule}[1]{\xrightarrow{#1}}
\newcommand{\bikapparule}[2]{\xleftrightarrow[#2]{#1}}
\newcommand{\iso}{iso}
\newcommand{\riso}{iso}
\newcommand{\dom}{}
\newcommand{\permut}[1][]{\xymatrix@C=0.6cm{{}&\ar@2@/_/@{~>}^{#1}[rr]&&{}}}
\newcommand{\permutbis}[1][]{\xymatrix@C=0.6cm{{}&\ar@2@/^/@{~>}^{#1}[rr]&&{}}}

\newcommand{\kade}{\textsc{KaDe}}
\newcommand{\erode}{\textsc{ERODE}}
\newcommand{\BNGL}{\textsc{BNGL}}

\newcommand{\squarespembedding}[9]{%
\begin{equation*}%
\xymatrix@C=\csize@R=\rsize{%
#3 \ar@{^{(}->}|{#1}^{#8}[r] & #5 \\%
#2  \ar@{^{(}->}|{#1}^{#6}[u]\ar@{^{(}->}|{#1}_{#7}[r] & #4\ar@{^{(}->}|{#1}_{#9}[u]}%
\end{equation*}}

\newcommand{\squareweakembedding}[8]{\squarespembedding{w}{#1}{#2}{#3}{#4}{#5}{#6}{#7}{#8}}

\newcommand{\imagesquareweakembedding}[9]{%
\squareweakembedding%
{\actiongraphlong{(\actionembactionlong{#1}{(#8#6)})}{#2}}%
{\actiongraphlong{(\actionembactionlong{#1}{#8})}{#3}}%
{\actiongraphlong{(\actionembactionlong{#1}{#9})}{#4}}%
{\actiongraphlong{#1}{#5}}%
{\actionembemblong{(\actionembactionlong{#1}{#8})}{#6}}%
{\actionembemblong{(\actionembactionlong{#1}{#9})}{#7}}%
{\actionembemblong{#1}{#8}}%
{\actionembemblong{#1}{#9}}}

\chapter{Symétrie dans les graphes à sites}
\label{chp:sym}

Les symétries apparaissent sous des formes diverses dans les modèles décrits par des règles de réécritures. Certaines sont indissociables de la sémantique. C'est le cas des automorphismes qui représentent des équivalences entre agents au sein de graphes à sites. D'autres peuvent décrire des équivalences entre sites d'interaction, des équivalences entre sortes de protéines ou encore des équivalences spatiales qui permettent de voir  la structure de certains complexes biochimiques modulo des isométries.

Dans \cite{feret:sasb2014}, nous avons introduit un cadre de travail algébrique unifiant pour décrire, inférer, et utiliser des groupes de transformations de graphes à sites dans le langage Kappa. L'idée principale est de considérer des groupes de transformations qui agissent sur les graphes à sites avec une opération supplémentaire permettant de restreindre une transformation sur les sous-graphes d'un graphe. Il est alors possible de définir quand un ensemble de règle est symétrique par rapport à ces groupes de transformation et d'en déduire  des propriétés au niveau du comportement global du modèle, que ce soit pour sa sémantique stochastique ou différentielle. Pour simplifier la présentation, nous nous concentrons ici aux symétries qui correspondent à  des échanges de sites, qui sont décrites dans \cite{Feret-MFPSXXVI}.


\paragraph*{Travaux voisins.} Plusieurs formalismes permettent de faire apparaître chaque site plusieurs fois dans l'interface des agents.
C'est le cas du langage BNGL \cite{DBLP:journals/bioinformatics/BlinovFGH04}.
Dans le langage ReactC \cite{DBLP:conf/esop/JohnLNV11}, des sites indistinguable peuvent être encodés à l'aide d'hyperliens. Ceci procure un moyen syntaxique  de décrire des sites symétriques.
En contre-partie, le calcul des l'ensembles des occurrences des motifs de réécriture devient prohibitif (les graphes ne sont plus rigides), ce qui pose de grands problèmes de complexité pour échantilloner les trajectoires de la sémantique stochastique.

En Kappa, la rigidité des graphes est un principe fondamental, et donc, l'utilisation de plusieurs occurrences d'un même site dans l'interface d'un agent est interdite. Les équivalences entre sites d'interaction peuvent toutefois être décrites à un plus haut-niveau de spécification  \cite{DBLP:journals/corr/abs-0911-2508} puis traduites automatiquement dans le noyau pure de Kappa. Cependant, il faut être conscient que cette traduction peut générer un très grand nombre de règles, là où une seule règle aurait été suffisante en utilisant des sites à occurrences multiples.

Dans ce chapitre, nous proposons une approche pour détecter automatiquement des équivalences entre sites d'interaction qui n'ont pas besoin d'être spécifiées à la main.
Puis, nous utilisons ces équivalences pour réduire l'espace d'état ou le nombre d'complexes biochimiques des modèles considérés. Ceci permet de réduire la dimension des systèmes différentiels sous-jacents et facilite le calcul de propriétés sur la distribution des traces de la sémantique stochastique. Ce n'est en revanche pas crucial pour l'échantillonnage des traces de la sémantique stochastique, puisque la simulation  travaille directement au niveau des graphes à sites \cite{DanosEtAl-APLAS07}.

Enfin, notre cadre de travail n'est pas limité à la prise en compte des équivalences entre sites d'interaction. Il peut être utilisé pour considérer des chaînes d'agents indépendamment de leur orientation ou des sous-groupes d'échanges de sites comme c'est courant en chemoinformatique.


\section*{Remerciements.}

Ce chapitre reprends donc les principaux résultats qui avaient été établis avec Ferdinanda Camporesi \cite{Feret-MFPSXXVI} à propos
de la détection et de la prise en compte d'équivalences entre sites d'interaction dans un noyau sans effets de bord du langage Kappa, pour réduire la combinatoire de ses modèles. L'extension à des groupes de symétries arbitraires et au langage complet qui est introduite dans \cite{feret:sasb2014} n'est évoquée qu'en conclusion de ce chapitre.

\section{Le cas d'études}

\newcommand{\dt}{\textrm{d} t}
\newcommand{\stateq}[1]{q_{{}_{#1}}}
\newcommand{\qone}[1][]{#1{\stateq{6,0,0,0}}}
\newcommand{\qtwo}[1][]{#1{\stateq{4,1,0,0}}}
\newcommand{\qthree}[1][]{#1{\stateq{4,0,1,0}}}
\newcommand{\qfour}[1][]{#1{\stateq{4,0,0,1}}}
\newcommand{\qfive}[1][]{#1{\stateq{2,2,0,0}}}
\newcommand{\qsix}[1][]{#1{\stateq{2,0,2,0}}}
\newcommand{\qseven}[1][]{#1{\stateq{2,0,0,2}}}
\newcommand{\qeight}[1][]{#1{\stateq{2,1,1,0}}}
\newcommand{\qten}[1][]{#1{\stateq{2,1,0,1}}}
\newcommand{\qnine}[1][]{#1{\stateq{2,0,1,1}}}
\newcommand{\qeleven}[1][]{#1{\stateq{0,3,0,0}}}
\newcommand{\qtwelve}[1][]{#1{\stateq{0,0,3,0}}}
\newcommand{\qthirteen}[1][]{#1{\stateq{0,0,0,3}}}
\newcommand{\qfourteen}[1][]{#1{\stateq{0,2,1,0}}}
\newcommand{\qfifteen}[1][]{#1{\stateq{0,2,0,1}}}
\newcommand{\qsixteen}[1][]{#1{\stateq{0,1,2,0}}}
\newcommand{\qtwenty}[1][]{#1{\stateq{0,1,1,1}}}
\newcommand{\qnineteen}[1][]{#1{\stateq{0,1,0,2}}}
\newcommand{\qseventeen}[1][]{#1{\stateq{0,0,2,1}}}
\newcommand{\qeighteen}[1][]{#1{\stateq{0,0,1,2}}}
\newcommand{\fifteen}[1]{\myfrac{30#1}{2}}
\newcommand{\one}[1]{\myfrac{2#1}{2}}
\newcommand{\two}[1]{\myfrac{4#1}{2}}
\newcommand{\three}[1]{\myfrac{6#1}{2}}
\newcommand{\six}[1]{\myfrac{12#1}{2}}
\newcommand{\probstate}[2][\!]{\probsymb_t{#1}\left(#2\right)\!}
\newcommand{\probinitstate}[2][\!]{\probsymb_0{#1}\left(#2\right)\!}
\newcommand{\diffprobstate}[1]{\myfrac{\textrm{d} \probstate[]{#1}}{\dt}}
\newcommand{\diffconc}[1]{\myfrac{\textrm{d} \conc{#1}}{\dt}}
\newcommand{\stateQ}[1]{Q_{#1}}
\newcommand{\Qzero}[1][]{#1{\stateQ{6,0}}}
\newcommand{\Qone}[1][]{#1{\stateQ{4,1}}}
\newcommand{\Qtwo}[1][]{#1{\stateQ{2,2}}}
\newcommand{\Qthree}[1][]{#1{\stateQ{0,3}}}
\newcommand{\Qgen}[1][]{#1{\stateQ{i,j}}}

\newcommand{\mono}{A_1}
\newcommand{\dimer}{A_2}

Nous illustrons la notion de symétries dans Kappa à travers un exemple jouet.

\subsection{Modèle}

Nous considérons un example dans lequel certains sites les sites d'une protéine ont exactement les mêmes capacités d'interaction.

\subsubsection{Les constituants du modèle et ses règles d'interaction}

\label{sec:modele}



On considère une unique sorte de protéine,  \agent{A}{}. On suppose que chaque occurrence de cette protéine dispose exactement de deux sites de liaison qui seront notés \site{x}{}{} et  \site{y}{}{}. Les sites de deux occurrences différentes de la protéine \agent{A}{} peuvent se lier arbitrairement de manière réversible. Il y a donc trois types de liaison, \site{x}{}{}-\site{x}{}{}, \site{x}{}{}-\site{y}{}{} et \site{y}{}{}-\site{y}{}{}, selon les sites qui sont impliqués dans la liaison. De plus, il est fait l'hypothèse que dans chaque occurrence de cette protéine, au plus un site peut être lié à la fois. Sous ces hypothèses, il existe exactement quatre sortes de complexes biochimiques\footnote{voir la section \ref{sec:complexe} pour la notion de complexe biochimique.}. Celles-ci sont toutes les quatre dessinées en Fig.~\ref{fig:chemicalspecies}.
L'occurrence d'un complexe biochimique est ainsi formée soit d'une occurrence de la protéine \agent{A}{} avec les deux sites libres (voir en Fig.~\ref{fig:sgsym21}), soit de deux occurrences de la protéine \agent{A}{} liées  par leurs deux sites \site{x}{}{} (voir en  Fig.~\ref{fig:sgsym22}), par leurs deux sites \site{y}{}{} (voir en Fig.~\ref{fig:sgsym23} ou par le site \site{x}{}{} de l'une et le site \site{y}{}{} de l'autre (voir en Fig.~\ref{fig:sgsym24}).


\begin{figure*}[t]
\hfill\subfigure[Une occurrence de la protéine \agentfont{A} avec ses deux sites de liaison libres.]%
{\label{fig:sgsym21}
\begin{minipage}{0.2\linewidth}\hfill\scalebox{\scalefactor}{\includegraphics{generated_pictures/sym_4_1_a.pdf}}\hfill\mbox{}\end{minipage}}%
\hfill\subfigure[Deux occurrences de la protéine \agentfont{A} liées par leurs deux sites \sitefont{x}.]%
{\label{fig:sgsym22}
\begin{minipage}{0.2\linewidth}\hfill\scalebox{\scalefactor}{\includegraphics{generated_pictures/sym_4_1_b.pdf}}\hfill\mbox{}\end{minipage}}%
\hfill\subfigure[Deux occurrences de la protéine \agentfont{A} liées par leurs deux sites \sitefont{y}.]%
{\label{fig:sgsym23}
\begin{minipage}{0.2\linewidth}\hfill\scalebox{\scalefactor}{\includegraphics{generated_pictures/sym_4_1_c.pdf}}\hfill\mbox{}\end{minipage}}%
\hfill\subfigure[Deux occurrences de la protéine \agentfont{A} liées respectivement par le site \sitefont{x} de l'une et le site \sitefont{y}{} de l'autre.]%
{\label{fig:sgsym24}
\begin{minipage}{0.2\linewidth}\hfill\scalebox{\scalefactor}{\includegraphics{generated_pictures/sym_4_1_d.pdf}}\hfill\mbox{}\end{minipage}}\caption{
Les quatre sortes de complexes biochimiques du cas d'étude sur les symétries.}
\label{fig:chemicalspecies}
\end{figure*}

\begin{figure*}[t]%
\hfill\subfigure[Règle de liaison entre les sites \sitefont{x} de deux occurrences de la protéine \agentfont{A} dont le site \sitefont{y} est libre.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym21}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_asso_a_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[Règle de liaison entre les sites \sitefont{y} de deux occurrences de la protéine \agentfont{A} dont le site \sitefont{x} est libre.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym22}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_asso_b_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[Règle de liaison entre le site \sitefont{x} d'une occurrence de la protéine \agentfont{A} et le site \sitefont{y} d'une autre occurrence de la protéine \agentfont{A}, sous la condition que le site \sitefont{y} de la première occurrence de protéine et le site \sitefont{x} de la seconde soient tous les deux libres.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym23}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_asso_c_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}
\caption{Les trois règles de liaison du cas d'étude sur les symétries.}
\label{fig:threerules}
\end{figure*}

\begin{figure*}[t]%
\hfill\subfigure[Règle de dissociation entre les sites \sitefont{x} de deux occurrences de la protéine \agentfont{A} dont le site \sitefont{y} est libre.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym21d}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_diss_a_sparse_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[Règle de dissociation entre les sites \sitefont{y} de deux occurrences de la protéine \agentfont{A} dont le site \sitefont{x} est libre.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym22d}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_diss_b_sparse_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[Règle de dissociation entre le site \sitefont{x} d'une occurrence de la protéine \agentfont{A} et le site \sitefont{y} d'une autre occurrence de la protéine \agentfont{A}, sous la condition que le site \sitefont{y} de la première occurrence de protéine et le site \sitefont{x} de la seconde soient tous les deux libres.]%
{\begin{minipage}{0.6\linewidth}\label{fig:rulesym23d}\hfill\incgraphics[\linewidth]{generated_pictures/sym_4_2_diss_c_sparse_id_id_rate.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}
\caption{Les trois règles de dissociation du cas d'étude sur les symétries.}
\label{fig:threerulesdiss}
\end{figure*}


\begin{sidewaysfigure}\scalebox{0.90}{\begin{minipage}{\linewidth}
\begin{equation*}
\begin{cases}
\diffprobstate{\qone}= \one{\kdxx}\probstate{\qtwo}
                      + \one{\kdyy}\probstate{\qthree}
                      + \kdxy{\cdot}\probstate{\qfour}
                      - \fifteen{(\kxx+\kyy+\kxy)}\probstate{\qone} \cr
\diffprobstate{\qtwo}= \fifteen{\kxx}\probstate{\qone}
                      + \two{\kdxx}\probstate{\qfive}
                      + \one{\kdyy}\probstate{\qeight}
                      + \kdxy{\cdot}\probstate{\qten}
                      - \myfrac{12(\kxx+\kyy+\kxy)+2\kdxx}{2}\probstate{\qtwo}\cr
\diffprobstate{\qthree}= \fifteen{\kyy}\probstate{\qone}
                       + \one{\kdxx}\probstate{\qeight}
                       + \two{\kdyy}\probstate{\qsix}
                       + \kdxy{\cdot}\probstate{\qnine}
                       - \myfrac{12(\kxx+\kyy+\kxy)+2\kdyy}{2}\probstate{\qthree}\cr
\diffprobstate{\qfour}= \fifteen{\kxy}\probstate{\qone}
                       + \one{\kdxx}\probstate{\qten}
                       + \one{\kdyy}\probstate{\qnine}
                       + 2\kdxy{\cdot}\probstate{\qseven}
                       - \left(\six{(\kxx+\kyy+\kxy)}+\kdxy\right)\!\probstate{\qfour}\cr
\diffprobstate{\qfive}= \six{\kxx}\probstate{\qtwo}
                      + \three{\kdxx}\probstate{\qeleven}
                      + \one{\kdyy}\probstate{\qfourteen}
                      + \kdxy{\cdot}\probstate{\qfifteen}
                      - \myfrac{2\kxx+2\kyy+2\kxy+4\kdxx}{2}\probstate{\qfive}\cr
\diffprobstate{\qeight}= \six{\kxx}\probstate{\qthree}
                       + \six{\kyy}\probstate{\qtwo}
                       + \two{\kdxx}\probstate{\qfourteen}
                       + \two{\kdyy}\probstate{\qsixteen}
                       + \kdxy{\cdot}\probstate{\qtwenty}
                       - \myfrac{2\kxx+2\kyy+2\kxy+2\kdxx+2\kdyy}{2}\probstate{\qeight}\cr
\diffprobstate{\qten}= \six{\kxx}\probstate{\qfour}
                     + \six{\kxy}\probstate{\qtwo}
                     + \two{\kdxx}\probstate{\qfifteen}
                     + \one{\kdyy}\probstate{\qtwenty}
                     + 2\kdxy{\cdot}\probstate{\qnineteen}
                     -\left(\frac{2\kxx+2\kyy+2\kxy+2\kdxx}{2}+\kdxy\right)\!\probstate{\qten}\cr
\diffprobstate{\qsix}= \six{\kyy}\probstate{\qthree}
                      + \one{\kdxx}\probstate{\qsixteen}
                      + \three{\kdyy}\probstate{\qtwelve}
                      + \kdxy{\cdot}\probstate{\qseventeen}
                      - \myfrac{2\kxx+2\kyy+2\kxy+4\kdyy}{2}\probstate{\qsix}\cr
\diffprobstate{\qnine}= \six{\kyy}\probstate{\qfour}
                      + \six{\kxy}\probstate{\qthree}
                      + \two{\kdxx}\probstate{\qtwenty}
                      + \two{\kdyy}\probstate{\qseventeen}
                      + 2\kdxy{\cdot}\probstate{\qeighteen}
                       - \left(\frac{2\kxx+2\kyy+2\kxy+2\kdyy}{2}+\kdxy\right)\!\probstate{\qnine}\cr
\diffprobstate{\qseven}= \six{\kxy}\probstate{\qfour}
                       + \one{\kdxx}\probstate{\qnineteen}
                       + \one{\kdyy}\probstate{\qeighteen}
                       + 3{\kdxy}\cdot\probstate{\qthirteen}
                       - \left(\frac{2\kxx+2\kyy+2\kxy}{2}+2{\cdot}\kdxy\right)\!\probstate{\qseven}\cr
\diffprobstate{\qeleven}= \one{\kxx}\probstate{\qfive}
                        - \three{\kdxx}\probstate{\qeleven}\cr
\diffprobstate{\qfourteen}=\one{\kxx}\probstate{\qeight}
                          +\one{\kyy}\probstate{\qfive}
                          -\myfrac{4\kdxx+2\kdyy}{2}\probstate{\qfourteen}\cr
\diffprobstate{\qfifteen}=\one{\kxx}\probstate{\qten}
                         + \one{\kxy}\probstate{\qfive}
                         -\left(\two{\kdxx}+\kdxy\right)\!\probstate{\qfifteen}\cr
\diffprobstate{\qsixteen}=\one{\kxx}\probstate{\qsix}
                         +\one{\kyy}\probstate{\qeight}
                         -\myfrac{2\kdxx+4\kdyy}{2}\probstate{\qsixteen}\cr
\diffprobstate{\qtwenty}= \one{\kxx}\probstate{\qnine}
                        + \one{\kyy}\probstate{\qten}
                        + \one{\kxy}\probstate{\qeight}
                        - \left(\myfrac{2\kdxx+2\kdyy}{2}+\kdxy\right)\!\probstate{\qtwenty}\cr
\diffprobstate{\qnineteen}=\one{\kxx}\probstate{\qseven}
                          +\one{\kxy}\probstate{\qten}
                          -\left(\one{\kdxx}+2\kdxy\right)\!\probstate{\qnineteen}\cr
\diffprobstate{\qtwelve}= \one{\kyy}\probstate{\qsix}
                        - \three{\kdyy}\probstate{\qtwelve}\cr
\diffprobstate{\qseventeen}=\one{\kyy}\probstate{\qnine}
                           + \one{\kxy}\probstate{\qsix}
                           -\left(\two{\kdyy}+\kdxy\right)\!\probstate{\qseventeen}\cr
\diffprobstate{\qeighteen}=\one{\kyy}\probstate{\qseven}
                          +\one{\kxy}\probstate{\qnine}
                          -\left(\one{\kdyy}+2\kdxy\right)\!\probstate{\qeighteen}\cr
\diffprobstate{\qthirteen}= \one{\kxy}\probstate{\qseven}
                          - 3\kdxy{\cdot}\probstate{\qthirteen}\cr
\end{cases}
\end{equation*}\end{minipage}}
\caption{Équation maîtresse pour le cas d'étude sur les symétries.}
\label{CME}
\end{sidewaysfigure}

Les règles du modèle sont décrites en Figs.~\ref{fig:threerules} et \ref{fig:threerulesdiss}. La Fig.~\ref{fig:threerules} contient trois règles de liaisons. La règle  dessinée en  Fig.~\ref{fig:rulesym21} stipule que deux occurrences de la protéine \agent{A}{} dont tous les sites sont libres peuvent lier leurs sites \site{x}{}{} respectifs avec la constante de réaction $\kxx$.
La règle donnée en  Fig.~\ref{fig:rulesym22} précise que deux occurrences de la protéine \agent{A}{} dont tous les sites sont libres peuvent lier leurs sites \site{y}{}{} respectifs avec la constante de réaction $\kyy$.
La règle dessinée en Fig.~\ref{fig:rulesym23} spécifie que
deux occurrences de la protéine \agent{A}{} dont tous les sites sont libres, peuvent se lier respectivement par le site \site{x}{}{} de l'une et le site \site{y}{}{} de l'autres avec la constante de réaction $\kxy$.
Ces différents types de liens peuvent être briser. Les règles de dissociation sont décrites en Fig.~\ref{fig:threerulesdiss}. Selon la règle donnée en Fig.~\ref{fig:rulesym21d}, un lien entre deux sites \site{x}{}{} peut être briser avec une constante de réaction $\kdxx$. Selon la règle dessinée en Fig.~\ref{fig:rulesym22d}, un lien entre deux sites \site{y}{}{} peut être briser avec une constante de réaction $\kdyy$. Enfin, le règle décrite en Fig.~\ref{fig:rulesym23d}, un lien entre deux sites \site{x}{}{} et \site{y}{}{} peut se casser avec une constante de réaction $\kdxy$.

\subsubsection{Le comportement du modèle}

D'un point de vue qualitatif, les sites \site{x}{}{} et \site{y}{}{} des occurrences de la protéine \agent{A}{} ont exactement les mêmes capacités d'interaction. On peut étudier de manière empirique ce que cela implique au niveau de la sémantique du modèle, et ce pour les deux types de sémantiques quantitatives, à savoir la sémantique stochastique et la sémantique différentielle.

\paragraph{Équation maîtresse.}

Pour regarder le comportement de la sémantique stochastique du modèle, nous proposons de nous concentrer sur la solution de son équation maîtresse \cite{1967}. Celle-ci décrit pour chaque état potentiel du système sous-jacent,  l'évolution temporelle de la probabilité que le système soit dans cet état. Comme il y a quatre sortes de complexes biochimiques,  l'état du système sera représenté par un vecteur de quatre entiers naturels. Ainsi la variable $\stateq{i,j,k,l}$ représente l'état dans lequel il y a exactement $i$ occurrence(s) de la protéine \agent{A}{} sans sites liés (voir en Fig.~\ref{fig:sgsym21}),
$j$ paires d'occurrences de la protéine \agent{A}{} liées par leurs deux sites \site{x}{}{} respectifs (voir en Fig.~\ref{fig:sgsym22}), $k$ paires d'occurrences de la protéine \agent{A}{} liées par leurs deux sites \site{y}{}{} respectifs (voir en Fig.~\ref{fig:sgsym23}), et $l$ paires d'occurrences de la protéine \agent{A}{} liées l'une par son site \site{x}{}{} et l'autre par son site \site{y}{}{} (voir en Fig.~\ref{fig:sgsym24}). L'équation maîtresse nécessite une variable par état potentiel. Pour faire tenir les équations sur une seule page, il est nécessaire de ne considérer qu'un nombre très limité de nombre d'occurrences de la protéine \agentfont{A}.
De ce fait, le système débutera avec la probabilité $1$ dans un état avec uniquement six occurrences de la protéine \agent{A}{}, avec tous leurs sites libres. Ainsi, comme les règles d'interaction conservent le nombre d'occurrences des protéines, seuls seront considérés les états $\state{i,j,k,l}$ pour lesquels $i+2\cdot(j+k+l) = 6$. Le système est dont constitué de vingt variables, en l'occurrence,  $\qone$, $\qtwo$, $\qthree$, $\qfour$, $\qfive$, $\qeight$, $\qten$, $\qsix$, $\qnine$, $\qseven$, $\qeleven$, $\qfourteen$, $\qfifteen$, $\qsixteen$, $\qtwenty$, $\qnineteen$, $\qtwelve$, $\qseventeen$, $\qeighteen$ et $\qthirteen$.

L'équation maîtresse de notre cas d'étude sur les symétries  est donnée en Fig.~\ref{CME}.  L'évolution temporelle de la distribution de probabilité de certains états est-elle donnée  en Fig.~\ref{distributionko} pour les paramètres cinétiques  $\kxx=\kxy=1$, $\kyy=\kdxx=\kdyy=2$, et $\kdxy=4$.

\begin{figure}[ht]
\begin{center}
\scalebox{0.55}{\input{generated_pictures/sym_KO_few}}
\end{center}
\caption{Évolution de la distribution de certains états en fonction du temps, avec les paramètres cinétiques
$\kxx=\kxy=1$, $\kyy=\kdxx=\kdyy=2$, et $\kdxy=4$, et la distribution d'états initiale $\probinitstate{\qone}=1$.}
\label{distributionko}%
\end{figure}

\paragraph{Sémantique différentielle.}

La sémantique différentielle du modèle est définie par le systèmes d'équations différentielles donné en Fig.~\ref{fig:sym:ode}. Ces équations décrivent l'évolution de la concentration des différents complexes biochimique sous les hypothèses de la loi d'action de masse. Les trajectoires de ce système en prenant pour état initial, l'état où les monomères de la protéine \agent{A}{} ont pour concentration $6$ et les dimers ont pour concentration $0$ sont décrites en Fig.~\ref{sym:trajectoires}.

\begin{figure}[ht]
\begin{equation*}
\begin{cases}
\diffconc{\pone} =
2\kdxy\conc{\pxy}+4\myfrac{\kdyy}{2}2\conc{\pyy}+4\myfrac{\kdxx}{2}2\conc{\pxx} - (2\myfrac{\kyy}{2} + 2\myfrac{\kxx}{2} + 2\myfrac{\kxy}{2})\conc{\pone}\cr
\diffconc{\pxx} = \myfrac{\kxx}2\conc{\pone}^2 -2\myfrac{\kdxx}{2}2\conc{\pxx}\cr
\diffconc{\pyy} = \myfrac{\kxy}2\conc{\pone}^2-2\myfrac{\kdyy}{2}2\conc{\pyy}\cr
\diffconc{\pxy} = \myfrac{\kyy}2\conc{\pone}^2-\kdxy\conc{\pxy}
\end{cases}
\end{equation*}
\caption{Système d'équations différentielles. La solution de ce système décrit l'évolution des concentrations des différents complexes biochimique en fonction du temps, sous les hypothèses de la loi d'Action de Masse.}
\label{fig:sym:ode}
\end{figure}
\begin{figure}[ht]
\begin{center}
\scalebox{0.55}{\input{generated_pictures/ode_KO}}
\end{center}
\caption{Évolution de la concentration des différents complexes biochimiques en fonction du temps, avec les paramètres cinétiques $\kxx=\kxy=1$, $\kyy=\kdxx=\kdyy=2$, et $\kdxy=4$, et l'état initiat $\conc{\pone}=6$ et $\conc{\pxx}=\conc{\pxy}=\conc{\pyy}=0$.
}
\label{sym:trajectoires}%
\end{figure}

\subsubsection{Symétries et propriétés comportementales}

Sans considérer les aspects quantitatifs, les sites \site{x}{}{} et \site{y}{}{} des occurrences de la protéine \agent{A}{} sont équivalents. Dès qu'une règle permet de lier le site \site{x}{}{} d'une occurrence de la protéine \agent{A}{} à un site, une autre règle permet de lier le site \site{y}{}{} de cette occurrence de protéine au même site. De même, quand une règle permet de casser un lien entre le site \site{x}{}{} d'une occurrence de protéine et un autre site, une autre règle permet de casser ce lien, si ce lien avait été porté par le site \site{y}{}{} ce cette occurrence de protéines.

Il est donc légitime de se poser la question suivante~:
quelles conséquences les équivalences entre sites peuvent-elles impliquer en terme de comportement du système sous-jacent et pour quelles conditions supplémentaires sur les paramètres cinétiques du modèle et son état initial (ou sa distribution d'états initiale) ?


\subsection{Modèle simplifié}

\label{par:forward}

Il semble naturel de vouloir oublier la différence entre des sites équivalents. Dans notre modèle, cela revient à ignorer la différence entre les sites \site{x}{}{} et \site{y}{}{} dans les occurrences de la protéine \agent{A}{}.
\`A ce niveau d'abstraction, les occurrences de la protéine \agent{A}{} auront donc chacune deux sites d'interaction, désormais supposés indistingables.

\subsubsection{Complexes biochimiques et règles d'interaction.}

Comme dessiné en Fig.~\ref{fig:Achemicalspecies}, il ne reste alors que deux sortes d'occurrences de complexes biochimiques, les occurrences du monomère de la protéine \agent{A}{} (qui ne sont formés que d'une occurrence de la protéine \agent{A}{} avec ses deux sites de liaison libres) et les occurrences de dimères de la protéine \agent{A}{} (qui sont constitués de deux occurrences de la protéine \agent{A}{} liées exactement par une liaison entre un site de l'une et un site de l'autre).


\begin{figure}[t]
\hfill\subfigure[Une occurrence de la protéine \agentfont{A} avec ses deux sites libres.]%
{\begin{minipage}{0.47\linewidth}\label{sgsym21}\hfill\incgraphics[0.4\linewidth]{generated_pictures/sym_4_9_a.pdf}\hfill\mbox{}\end{minipage}}\hfill
\subfigure[Deux occurrences de la protéine \agentfont{A} liées entre elles. .]%
{\begin{minipage}{0.47\linewidth}\label{sgsym22}\hfill\incgraphics[0.4\linewidth]{generated_pictures/sym_4_9_b.pdf}\hfill\mbox{}\end{minipage}}\hfill\mbox{}
\caption{Les deux sortes de complexes biochimiques dans le modèle simplifié. Le nom des sites a été retiré car ils sont maintenant supposés indistinguables.}
\label{fig:Achemicalspecies}
\end{figure}


%\subsubsection{Règles simplifiées}

Par ailleurs, les règles se simplifient de la même manière.
Puisqu'il n'y a plus de distinctions entre les sites de liaison de chaque occurrence de la protéine \agent{A}{}, les trois règles de liaison peuvent se résumer en une seule, ainsi que les règles de dissociation.
 %Il faut cependant prendre garde pour fixer les constantes cinétiques de ces règles.
%\'Etant donné deux occurrences de la protéine \agentfont{A} dont tous les sites sont libres, il y avait auparavant trois règles pour créer un lien entre ces deux occurrences et chacune d'elles pouvait  s'appliquer de deux manières différentes (selon le choix de quelle occurrence est utilisée pour la première occurrence de la protéine \agent{A}{} du membre grauche de la règle) possibilité de créer un liaison pour une constante de réaction  corrigée totale $\smallfrac{2\kxx+2\kyy+2\kxy}{2}$. Du coup, pour simuler ces règles et rester fidèle à la cinétique, la constante de réaction corrigée de la nouvelle règle devra être égale elle aussi à $\smallfrac{2\kxx+2\kyy+2\kxy}{2}$. Par ailleurs, étant données deux occurrences de la protéine \agent{A}{}, une seule règle s'applique pour briser ce lien. Si le lien est entre deux sites \sitefont{x}{}{}, cette règle peut s'appliquer de deux manières pour une constante de réaction cumulée corrigée  de $\smallfrac{2\kdxx}{2}$.
%Si le lien est entre deux sites \sitefont{y}{}{}, cette règle peut s'appliquer de deux manières pour une constante de réaction cumulée corrigée  de $\smallfrac{2\kdyy}{2}$. Enfin si le lien est entre un site \sitefont{x}{}{} et un site \sitefont{y}{}{}, la règle peut s'appliquer de deux manières pour une constante de réaction cumulée corrigée  de $\smallfrac{2\kdxy}{2}$. Du coup, la simplication n'est possible que si les trois constantes $\kdxx$, $\kdyy$ et $\kdxy$ sont égales. Dans ce cas, la constante de la règle de dissociation dans le modèle simplifié sera fixé à $\kdxx$.
Les deux règles du modèle simplifié sont données en Figs.~\ref{Arule} et \ref{Aruled}. La constante de réaction pour la règle de liaison est notée $\K$, alors que celle pour la règle de dissociation $\KD$ (dans le modèle simplifié).


\begin{figure}[t]%
{\label{rulesym211}\hfill\incgraphics{generated_pictures/sym_4_11.pdf}\hfill\mbox{}}
\caption{La règle de liaison du modèle simplifié.
Deux occurrences de la protéine \agentfont{A} peuvent se lier à une constante de réaction $\K$ (peu importe à quels sites) quand tous leurs sites sont libres.}
\label{Arule}
\end{figure}

\begin{figure}[t]%
{\label{rulesym211}\hfill\incgraphics{generated_pictures/sym_4_11_sparse.pdf}\hfill\mbox{}}
\caption{La règle de dissociation du modèle simplifié.
Le lien entre deux occurrences de la protéine \agentfont{A} peut se rompre avec une constante de réaction $\KD$.}
\label{Aruled}
\end{figure}

\subsubsection{États des systèmes stochastiques et différentiels sous-jacent.}

Les états du système stochastique sous-jacent sont donc décrits par le nombre d'occurrences du monomère de la protéine \agent{A}{} (qui sont formées  d'une occurrence de la protéine \agent{A}{}) et le nombre d'occurrences du dimère de la protéine \agent{A}{} (qui sont formées de deux occurrences de la protéine \agent{A}{} liées entre-elles). Un tel état sera noté $\Qgen$ avec $i$ le nombre d'occurrences du monomère et $j$ le nombre d'occurrences de dimères de la protéine \agent{A}{}.

Quant à eux, les états du système différentiel sous-jacent sont décrits par deux concentrations. La concentration en monomère est notée $\conc{\mono}$ alors que celle en dimère est notée $\conc{\dimer}$.


\subsubsection{Systèmes dynamiques sous-jacent}

\paragraph{\'Equation maîtresse.}

L'équation maîtresse du modèle simplifié est donnée en Fig.~\ref{LCME}. La solution de ce système d'équations définit
donc l'évolution de la distribution de probabilités du nombre de dimers au cours du temps dans la sémantique stochastique.
Seuls les états accessibles à partir de six monomères ont été considérés, c'est à dire les quatre états potentiels $\Qzero$, $\Qone$, $\Qtwo$ et $\Qthree$.

\begin{figure}[h]
\scalebox{0.86}{\begin{minipage}{\linewidth}
\begin{equation*}
\begin{cases}
\diffprobstate{\Qzero} = \one{\KD}\probstate{\Qone}
                       - \fifteen{\K}\probstate{\Qzero}\cr
\diffprobstate{\Qone} = \fifteen{\K}\probstate{\Qzero}
                      + \two{\KD}\probstate{\Qtwo}
                      - \left(\six{\K}+\one{\KD}\right)\probstate{\Qone}\cr
\diffprobstate{\Qtwo} = \six{\K}\probstate{\Qone}
                      + \three{\KD}\probstate{\Qthree}
                      - \left(\one{\K} + \two{\KD}\right)\probstate{\Qtwo}\cr
\diffprobstate{\Qthree} = \one{\K}\probstate{\Qtwo}
                      - \three{\KD}\probstate{\Qthree}\cr
\end{cases}
\end{equation*}\end{minipage}}
\caption{Chemical Master Equation of the reduced model.}
\label{LCME}
\end{figure}

\paragraph{Sémantique différentielle.}

La sémantique différentielle est quant à elle donnée en Fig.~\ref{LODE}. Elle donne l'évolution de la concentration en monomère, $\conc{\mono}$, et en dimère, $\conc{\dimer}$, au cours du temps, sous les hypothèses de la loi d'action de masse.

\begin{figure}[h]
\scalebox{0.86}{\begin{minipage}{\linewidth}
\begin{equation*}
\begin{cases}
\diffconc{\mono}= \two{\KD}\conc{\dimer}-\one{\K}\conc{\mono}^2\cr
\diffconc{\dimer} = \myfrac{\K}{2}\conc{\mono}^2 -
\one{\KD}\conc{\dimer} \cr
\end{cases}
\end{equation*}\end{minipage}}
\caption{système différentiel pour le modèle simplifié.}
\label{LODE}
\end{figure}

\subsection{Comparaison des dynamiques des deux modèles}

\subsubsection{Quotient}

Les composants de modèle simplifié ont été définis de manière  intentionnelle sous la forme de graphe à sites. Quelques écarts ont été pris par rapport à la syntaxe de Kappa. En effet, celle-ci ne permet pas de répéter des sites dans l'interface d'une protéine. Cette description intentionnelle permet des raisonnements intuitifs sur le comportement des composants du modèle simplifié. Toutefois, une caractérisation extensionnelle de ces composante est requise pour relier formellement les composants du modèle simplifié au composants du modèle initial et ainsi justifier rigoureusement ces raisonnements. Il suffit pour cela d'interpréter les complexes biochimiques et les états du modèle simplifié respectivement comme des classes d'équivalences de complexes biochimiques et d'états du modèle initial. Les complexes biochimiques sont regroupés en deux classes, les monomères et les dimères. Ainsi, dans le cadre différentiel, les variables du modèle simplifié correspondent à la somme des concentrations des complexe biochimiques dans chaque classe d'équivalences de complexes biochimiques, comme indiqué en Fig.~\ref{changevarode}.
De la même manière, les états du système stochastique initial peuvent être regroupés selon le nombre d'occurrences du monomère de la protéine \agent{A}{} et le nombre global des trois types de dimères de la protéine \agent{A}{}. Du coup, à partir d'un état initial formé de $6$ occurrences de la protéine \agent{A}{} aves ses deux sites sont libres, il est possible d'attendre des états dans exactement $4$ classes d'équivalence, selon qu'il y ait $0$, $1$, $2$ ou $3$ dimères. Ceci peut être étendu aux distributions d'états qui apparaissent dans l'équation maîtresse~: la probabilité d'avoir exactement $i$ monomères et $j$ dimères est alors vue comme la somme des probabilité des états du modèle initial ayant exactement $i$ monomères et $j$ dimères. Cette relation est exprimée en Fig.~\ref{changevarctmc} pour les états accessibles à partir de $6$ occurrences de la protéine \agent{A}{} avec les deux sites de liaison libres.

\begin{sidewaysfigure}\scalebox{0.90}{\begin{minipage}{\linewidth}
\begin{equation*}
\begin{cases}
\diffprobstate{\qone}= \one{\kdxx}\probstate{\qtwo}
                      + \one{\kdyy}\probstate{\qthree}
                      + \kdxy{\cdot}\probstate{\qfour}
                      - \fifteen{(\kxx+\kyy+\kxy)}\probstate{\qone} \cr
\diffprobstate{\qtwo}= \fifteen{\kxx}\probstate{\qone}
                      + \two{\kdxx}\probstate{\qfive}
                      + \one{\kdyy}\probstate{\qeight}
                      + \kdxy{\cdot}\probstate{\qten}
                      - \myfrac{12(\kxx+\kyy+\kxy)+2\kdxx}{2}\probstate{\qtwo}\cr
\diffprobstate{\qthree}= \fifteen{\kyy}\probstate{\qone}
                       + \one{\kdxx}\probstate{\qeight}
                       + \two{\kdyy}\probstate{\qsix}
                       + \kdxy{\cdot}\probstate{\qnine}
                       - \myfrac{12(\kxx+\kyy+\kxy)+2\kdyy}{2}\probstate{\qthree}\cr
\diffprobstate{\qfour}= \fifteen{\kxy}\probstate{\qone}
                       + \one{\kdxx}\probstate{\qten}
                       + \one{\kdyy}\probstate{\qnine}
                       + 2\kdxy{\cdot}\probstate{\qseven}
                       - \left(\six{(\kxx+\kyy+\kxy)}+\kdxy\right)\!\probstate{\qfour}\cr
\diffprobstate{\qfive}= \six{\kxx}\probstate{\qtwo}
                      + \three{\kdxx}\probstate{\qeleven}
                      + \one{\kdyy}\probstate{\qfourteen}
                      + \kdxy{\cdot}\probstate{\qfifteen}
                      - \myfrac{2\kxx+2\kyy+2\kxy+4\kdxx}{2}\probstate{\qfive}\cr
\diffprobstate{\qeight}= \six{\kxx}\probstate{\qthree}
                       + \six{\kyy}\probstate{\qtwo}
                       + \two{\kdxx}\probstate{\qfourteen}
                       + \two{\kdyy}\probstate{\qsixteen}
                       + \kdxy{\cdot}\probstate{\qtwenty}
                       - \myfrac{2\kxx+2\kyy+2\kxy+2\kdxx+2\kdyy}{2}\probstate{\qeight}\cr
\diffprobstate{\qten}= \six{\kxx}\probstate{\qfour}
                     + \six{\kxy}\probstate{\qtwo}
                     + \two{\kdxx}\probstate{\qfifteen}
                     + \one{\kdyy}\probstate{\qtwenty}
                     + 2\kdxy{\cdot}\probstate{\qnineteen}
                     -\left(\frac{2\kxx+2\kyy+2\kxy+2\kdxx}{2}+\kdxy\right)\!\probstate{\qten}\cr
\diffprobstate{\qsix}= \six{\kyy}\probstate{\qthree}
                      + \one{\kdxx}\probstate{\qsixteen}
                      + \three{\kdyy}\probstate{\qtwelve}
                      + \kdxy{\cdot}\probstate{\qseventeen}
                      - \myfrac{2\kxx+2\kyy+2\kxy+4\kdyy}{2}\probstate{\qsix}\cr
\diffprobstate{\qnine}= \six{\kyy}\probstate{\qfour}
                      + \six{\kxy}\probstate{\qthree}
                      + \two{\kdxx}\probstate{\qtwenty}
                      + \two{\kdyy}\probstate{\qseventeen}
                      + 2\kdxy{\cdot}\probstate{\qeighteen}
                       - \left(\frac{2\kxx+2\kyy+2\kxy+2\kdyy}{2}+\kdxy\right)\!\probstate{\qnine}\cr
\diffprobstate{\qseven}= \six{\kxy}\probstate{\qfour}
                       + \one{\kdxx}\probstate{\qnineteen}
                       + \one{\kdyy}\probstate{\qeighteen}
                       + 3{\kdxy}\cdot\probstate{\qthirteen}
                       - \left(\frac{2\kxx+2\kyy+2\kxy}{2}+2{\cdot}\kdxy\right)\!\probstate{\qseven}\cr
\diffprobstate{\qeleven}= \one{\kxx}\probstate{\qfive}
                        - \three{\kdxx}\probstate{\qeleven}\cr
\diffprobstate{\qfourteen}=\one{\kxx}\probstate{\qeight}
                          +\one{\kyy}\probstate{\qfive}
                          -\myfrac{4\kdxx+2\kdyy}{2}\probstate{\qfourteen}\cr
\diffprobstate{\qfifteen}=\one{\kxx}\probstate{\qten}
                         + \one{\kxy}\probstate{\qfive}
                         -\left(\two{\kdxx}+\kdxy\right)\!\probstate{\qfifteen}\cr
\diffprobstate{\qsixteen}=\one{\kxx}\probstate{\qsix}
                         +\one{\kyy}\probstate{\qeight}
                         -\myfrac{2\kdxx+4\kdyy}{2}\probstate{\qsixteen}\cr
\diffprobstate{\qtwenty}= \one{\kxx}\probstate{\qnine}
                        + \one{\kyy}\probstate{\qten}
                        + \one{\kxy}\probstate{\qeight}
                        - \left(\myfrac{2\kdxx+2\kdyy}{2}+\kdxy\right)\!\probstate{\qtwenty}\cr
\diffprobstate{\qnineteen}=\one{\kxx}\probstate{\qseven}
                          +\one{\kxy}\probstate{\qten}
                          -\left(\one{\kdxx}+2\kdxy\right)\!\probstate{\qnineteen}\cr
\diffprobstate{\qtwelve}= \one{\kyy}\probstate{\qsix}
                        - \three{\kdyy}\probstate{\qtwelve}\cr
\diffprobstate{\qseventeen}=\one{\kyy}\probstate{\qnine}
                           + \one{\kxy}\probstate{\qsix}
                           -\left(\two{\kdyy}+\kdxy\right)\!\probstate{\qseventeen}\cr
\diffprobstate{\qeighteen}=\one{\kyy}\probstate{\qseven}
                          +\one{\kxy}\probstate{\qnine}
                          -\left(\one{\kdyy}+2\kdxy\right)\!\probstate{\qeighteen}\cr
\diffprobstate{\qthirteen}= \one{\kxy}\probstate{\qseven}
                          - 3\kdxy{\cdot}\probstate{\qthirteen}\cr
\end{cases}
\end{equation*}\end{minipage}}
\caption{Équation maîtresse.}
\label{CMEbis}
\end{sidewaysfigure}



\begin{figure}[t]
\begin{equation*}
\begin{cases}
\probstate{\Qzero}  =  \probstate{\qone} \cr
\probstate{\Qone}   =  \probstate{\qtwo} + \probstate{\qthree} + \probstate{\qfour} \cr
\probstate{\Qtwo}  =  \probstate{\qfive} + \probstate{\qeight} + \probstate{\qten}  + \probstate{\qsix} + \probstate{\qnine} + \probstate{\qseven}  \cr
\prob{\Qthree}  =  \probstate{\qeleven} + \probstate{\qfourteen} + \probstate{\qfifteen} + \probstate{\qsixteen} + \probstate{\qtwenty} + \probstate{\qnineteen}\cr
\hspace*{1.5cm}+ \probstate{\qtwelve} + \probstate{\qseventeen} + \probstate{\qthirteen} +\probstate{\qeighteen} + \probstate{\qnineteen}. \cr
\end{cases}
\end{equation*}
\caption{Définition extensionnelle des variables de l'équation maîtresse du modèle simplifié. }
\label{changevarctmc}
\end{figure}

\begin{figure}[t]
\begin{equation*}
\begin{cases}
\conc{\mono}=\conc{\pone}\cr
\conc{\dimer}=\conc{\pxx}+\conc{\pyy}+\conc{\pxy}
\end{cases}
\end{equation*}
\caption{Définition extensionnelle des variables du modèle simplifié pour le cadre différentiel.}
\label{changevarode}
\end{figure}


Il existe donc deux manières de calculer le comportement du modèle simplifié~: soit en résolvant directement les équations
du modèle simplifié, soit en résolvant le modèle initial et en
calculant le comportement du modèle simplifié à l'aide de la caractérisation extensionnelle de ses composants. %Cependant, ceci n'est possible que si les trois paramètres $\kdxx$, $\kdyy$ et $\kdxy$ sont égaux. Dans ce cas, le paramètre $\K$ doit être pris comme la somme des paramètres  $\kxx$, $\kyy$ et $\kxy$, alors que le paramètre $\KD$ doit être égal au paramètre $\kdxx$. De plus, la distribution du système initial, dans le cadre stochastique, ou l'état initial, dans le cadre différentiel, doivent être choisi pour satisfaire la caractérisation extensionnelle des composants du modèle simplifié.

En Fig.~\ref{fig:comparison} est montrée la comparaison empirique entre ces deux méthodes pour plusieurs jeux de paramètres, que ce soit dans la cadre stochastique ou différentiel.
La colonne de gauche est consacrée aux solutions des équations maîtresses alors que la colonne de droite porte sur celles des équations aux concentrations. Quatre jeux de paramètres sont considérés.
Même si les paramètres n'ont pas la même signification dans le cadre stochastique et dans celui différentiel, la comparaison est faîte avec les mêmes valeurs numériques. Dans chaque graphique,  les lignes continues sont obtenues en considérant le modèle initial et en projetant les résultats à l'aide de la caractérisation extensionnelle des composants du modèle simplifié alors que les courbes obtenues directement avec le modèle simplifié sont dessinées avec des tirets.

Le but de ces simulations numériques est de tester l'importance de trois contraintes. La première contrainte concerne les constantes de réaction pour les règles de dissociation. La seconde concerne l'état (ou la distribution d'états) initial(le). Enfin, la troisième concerne les constantes de réaction pour les règles de liaison.
\begin{itemize}
\item \textbf{Contrainte sur les constantes de dissociation.} Intuitivement, pour que les sites \site{x}{}{} et \site{y}{}{} des occurrences de la protéine \agent{A}{} tiennent un rôle symétrique, il est nécessaire que chaque lien puisse se défaire avec la même vitesse. Notons que les règles de dissociation pour les liens symétriques (entre deux sites \site{x}{}{} ou entre deux sites \site{y}{}{}) peuvent s'appliquer deux fois, mais, par convention, leurs constantes de réaction sont divisées par $2$. Aussi pour chaque type de lien puisse se défaire avec la même cinétique, il faut que les trois constantes $\kdxx$, $\kdyy$ et $\kdxy$ soient égales. Enfin, pour que le modèle simplifié puisse simuler ce comportement, il faut prendre la constante $\KD$ égale à la valeur commune des trois constantes de dissociation.
\item \textbf{Contrainte sur l'état initial ou la distribution initiale.}  La seconde contrainte concerne l'état initial (ou la distribution des états initiaux). Elle a pour but de tester empiriquement l'importance que les sites \site{x}{}{} et \site{y}{}{} soient, ou non, indistingables dans la distribution initiale (ou dans l'état initial). Pour cela, sous cette hypothèse, on ne considérera que des occurrences de la protéine \agent{A}{} dont tous les sites \site{x}{}{} et \site{y}{}{} sont libres (puisque c'est la seule conformation de la protéine \agent{A}{} dans laquelle les deux sites sont dans le même état).
\item \textbf{Contrainte sur les constantes de liaison.} La troisième contrainte concerne les règles de liaison.
On peut se demander s'il est important que les liaisons entre deux occurrences libres de la protéine \agent{A}{} peuvent s'établir de manière équiprobable entre les $4$ positions potentielles (\sitefont{x}-\sitefont{x}, \sitefont{y}-\sitefont{y}, \sitefont{x}-\sitefont{y} et \sitefont{y}-\sitefont{x}). On a ici distingué les deux occurrences de la protéine \agent{A}{} dans les dimères.
Il faut se rappeler que les trois constantes de réaction correspondantes sont, par convention, divisées par $2$. Cependant les règles de liaison symétrique offrent chacune deux manières de créer la liaison correspondante (car les deux occurrences de la protéine $\agent{A}{}$ jouent exactement le même rôle dans la règle), alors que la règle de liaison asymétrique peut établir deux liaisons différentes si l'on distingue les deux occurrences de la protéine \agent{A}{} auxquelles on applique la règle de liaison. De ce fait, la troisième contrainte spécifie que les constantes $\kxx$ et $\kyy$ sont égales et que la constante $\kxy$ est égale au double de la contrainte $\kxx$. Par ailleurs, pour simuler ces règles, la constante $\K$ sera choisie comme la somme des trois constantes $\kxx$, $\kyy$ et $\kxy$. En effet, les trois règles de liaison du modèle initial, ainsi que celle du modèle simplifié peut s'appliquer dans deux positions chacune par paire d'occurrences libres de la protéine \agent{A}{}, et d'autre part ces quatre constantes sont toutes divisées par $2$ par convention.
\end{itemize}



%L'élaboration du modèle simplifié a mis en lumière qu'il était suffisant que que les constantes de dissociation $\kdxx$, $\kdxy$ et $\kdyy$ soient tous trois égaux. C'est la première contrainte qui sera considérée. Par ailleurs, il semble légitime de se demander si des contraintes sur la distribution initiale (ou sur l'état initial dans le cadre différentiel) et sur les constantes d'association ont aussi des conséquences notables. Aussi l'importance que les sites \site{x}{}{} et \site{y}{}{} soient, ou non, indistingables dans la distribution initiale (ou l'état initial) sera également testé empiriquement et, par ailleurs, l'impact de la contrainte qui impose aux deux constantes $\kxx$ et $\kyy$ d'être égales et à la constante $\kxy$ d'être le double de leur valeur commune sera aussi testé (le choix des rapports sera expliquer plus tard).

La correspondance entre le modèle initial et le modèle simplifiée est testée, pour la sémantique stochastique et pour la sémantique différentielle, sous quatre scénarios. Dans le premier, les trois contraintes de symétrie sont satisfaites, alors que les autres scénarios invalident exactement une de ces contraintes.


\begin{figure*}[hp]
\hfill\subfigure[$\kxx=\kyy=1$,  $\kxy=\kdxx=\kdyy=\kdxy=2$ et $\probinitstate{\qone}=1$~; $\K=4$, $\KD=2$,
et $\probinitstate{\Qzero}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcsym}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.12.1}}}
\end{center}
\end{minipage}}
\hfill
\subfigure[$\kxx=\kyy=1$,  $\kxy=\kdxx=\kdyy=\kdxy=2$, initialement $\conc{\pone}=6$ et  $\conc{\pxx}=\conc{\pxy}=\conc{\pyy}=0$~; $\K=4$, $\KD=2$, initialement $\conc{\mono}=6$ et $\conc{\dimer}=0$.]
{\begin{minipage}{0.45\linewidth}
\label{figodesym}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.12.1}}}
\end{center}
\end{minipage}}\hfill\mbox{}


\hfill\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=2$,  $\kdxy=4$ et $\probinitstate{\qone}=1$~;
$\K=4$, $\KD=3$ et $\probinitstate{\Qzero}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnonsymkd}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.12.4}}}
\end{center}\end{minipage}}\hfill
\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=2$,  $\kdxy=4$,   initialement $\conc{\pone}=6$ sans dimère~; $\K=4$, $\KD=3$,  initialement $\conc{\mono}=6$ et $\conc{\dimer}=0$. ]%
{\begin{minipage}{0.45\linewidth}
\label{figodenonsymkd}
\begin{center}{\scalebox{0.45}{\input{generated_pictures/ode.4.12.4}}}
\end{center}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=\kdxy=2$,
$\probinitstate{\qfive}=1$~; $\K=4$, $\KD=2$, $\probinitstate{\Qtwo}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnotsyminitial}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.12.2}}}
\end{center}\end{minipage}}
\hfill
\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=\kdxy=2$,
initialement $\conc{\pone}=\conc{\pxx}=2$ et $\conc{\pyy}=\conc{\pxy}=0$~; $\K=4$, $\KD=2$, initialement
$\conc{\mono}=\conc{\dimer}=2$.]%
{\begin{minipage}{0.45\linewidth}
\label{figodenotsyminitial}\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.12.2}}}
\end{center}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[$\kxx=1$, $\kyy=2$, $\kxy=4$,  $\kdxx=\kdyy=\kdxy=2$ et $\probinitstate{\qone}=1$~;
$\K=7$, $\KD=2$ et $\probinitstate{\Qzero}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnotsymasso}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.12.3}}}
\end{center}\end{minipage}}
\hfill
\subfigure[$\kxx=1$, $\kyy=2$, $\kxy=4$,  $\kdxx=\kdyy=\kdxy=2$ initialement $\conc{\pone}=6$ sans dimère~;
$\K=7$, $\KD=2$, initialement $\conc{\mono}=6$ et $\conc{\dimer}=0$.]%
{\begin{minipage}{0.45\linewidth}
\label{figodenotsymasso}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.12.3}}}
\end{center}\end{minipage}}\hfill\mbox{}

\caption{Comparaison entre le comportement du modèle initial
(traits continus) et celui du modèle simplifié (tirets). À gauche, évolution de la distribution de probabilités du nombre de dimères pour différents paramètres cinétiques et différentes distributions d'états initiaux dans le système stochastique sous-jacent. À droite, évolution de la concentration en dimère  pour différents paramètres cinétiques et différentes concentrations initiales. }
\label{fig:comparison}
\end{figure*}

La description de chaque scénario et des résultats obtenus est donnée ci-dessous~:
\begin{enumerate}
\item Dans le premier jeu de paramètres, les trois contraintes sont satisfaites. Les constantes
$\kxx$ et $\kyy$ sont fixées à $1$, alors que les constantes
$\kxy$, $\kdxx$, $\kdyy$ et $\kdxy$ sont fixées à $2$.
Le système stochastique sous-jacent débute de l'état formé de $6$ occurrences de la protéine \agent{A}{} sans lien, et le système différentiel de l'état où les monomères sont présent en concentration $6$, et les dimères absents.
Les courbes montrent que la distribution des
états du modèle simplifié correspondent exactement (voir en Fig.~\ref{figctmcsym})~:  les mêmes valeurs sont obtenues en calculant l'évolution de la distribution des états dans le modèle initial et en regroupant les états selon le nombre d'occurrences de dimère (courbes continues) ou en calculant la distribution des états dans le modèle simplifié directement (tirets). Le même phénomène se retrouve dans les systèmes différentiels sous-jacents. Les courbes en Fig.~\ref{figodesym} montrent que les mêmes concentrations sont obtenues en regroupant  la concentration des dimères dans le modèle initial ou en calculant directement cette concentration dans le modèle simplifié.


\item Dans le second jeu de paramètres,
la contrainte sur les constantes de dissociation n'est plus satisfaite. Les constantes d'association et la distribution des états initiaux (ou l'état initial dans le cadre différentiel) sont gardées telles quelles, ainsi que les constantes de dissociation $\kdxx$ et $\kdyy$. Mais la constante de dissociation $\kdxy$ est maintenant fixée à $4$. Les trois constantes de dissociation du modèle initial n'étant pas égales, il n'y a pas de manière intuitive de fixer la constante de dissociation du modèle simplifié.
Elle est prise arbitrairement égale à la moyenne entre la constante de dissociation des liens symétriques et celle des liens asymétriques, à savoir $3$.   On peut alors constater à la fois dans le cadre stochastique et dans le cadre différentiel un écart entre le comportement du modèle initial et du modèle simplifié (voir en Fig.~\ref{figctmcnonsymkd} et en Fig.~\ref{figodenonsymkd}). Une telle disparité aurait été observée quelque soit la valeur de la constante $\KD$.


\item Le troisième jeu de paramètres a pour but de tester l'importance éventuelle de l'état initial. Par rapport au premier jeu de paramètres, seule la distribution des états initiaux (ou l'état initial dans le cadre différentiel) est modifiée. Le système stochastique débute dans un état avec deux occurrences de la protéine \agent{A}{} sans lien, et deux occurrences du dimère symétrique  de la protéine \agent{A}{} formées par des liens sur les sites \site{x}{}{}. Quant au système différentiel, il démarre d'un état où les monomères et les dimères $\sitefont{x}-\sitefont{x}$ sont en concentration $2$, alors que les deux autres formes de dimère sont en concentration $0$.  l'évolution des distributions d'états des deux systèmes stochastiques sous-jacents est dessinée en Fig.~\ref{figctmcnotsyminitial}, alors que l'évolution des concentrations en monomère et en dimère dans les deux systèmes différentiels sous-jacents est donnée en Fig.~\ref{figodenotsyminitial}.
À la fois, le cadre stochastique et dans le cadre différentiel,
les courbes coïncident entre le modèle initial et le modèle simplifié, ce qui suggère que la correction de la simplification du modèle ne dépend pas de la distribution initiale (ou de l'état initial dans le cadre stochastique).

\item Enfin, le quatrième jeu de paramètres vise à tester l'impact de la contrainte sur les constantes d'association. Les paramètres sont les mêmes que dans le premier jeu, sauf la constante $\kyy$ qui est fixée à $2$ et la constante $\kxy$ qui est fixée à $4$. De plus, la constante d'association dans le modèle simplifié, $\K$,  reste la somme des constantes d'association dans le modèle initial, c'est à dire $7$. Là encore, le comportement du modèle initial et celui du modèle simplifié coincident, que ce soit pour la sémantique stochastique ou la sémantique différentielle (voir en Fig.~\ref{figctmcnotsymasso} et en Fig.~\ref{figodenotsymasso}).
\end{enumerate}


Ainsi, si l'égalité entre les constantes de dissociation
semble cruciale pour pouvoir simplifier le modèle de manière exacte, le choix de la distribution initiale (ou de l'état initial) et des constantes d'association ne semblent pas importantes. Pour les constantes d'association, ceci s'explique par la simplicité du cas d'étude, puisque que les règles de liaison ne lient que des monomères et que ces monomères sont invariants par échange de leurs sites \site{x}{}{} et \site{y}{}{}. De manière général, les conditions sur les constantes cinétique portent sur des règles qui effectuent des actions similaires sur des motifs équivalents à échange de sites près. La correction du modèle simplifiée peut alors s'expliquer par une bisimulation en-avant \cite{1347609} sur l'espace des états du système stochastique sous-jacent ou de son analogue différentiel \cite{Cardelli2015ForwardAB}.

\subsubsection{Invariants quantitatifs}

Dans le paragraphe \ref{par:forward}, le fait que certains sites puissent partager exactement les mêmes capacités d'interaction a été exploité pour simplifier un modèle jouet de manière exacte. Les composés du modèle simplifié ont été reliés formellement à ceux du modèle initial et les mêmes résultats ont été obtenus en exécutant le modèle initial avant d'utiliser ces relations formelles pour en déduire  l'évolution des composants du modèle simplifié ou en exécutant directement le modèle simplifié.

Une autre classe de propriétés intéressante est celle des invariants quantitatifs. Il semble naturel de supposer que lorsque deux sites sont équivalents dans toutes les occurrences d'une protéine, alors, dans le cadre stochastique, les états obtenus en permutant ces deux sites dans une ou plusieurs occurrences de cette protéine dans un état donné soient équiprobables.
De même, dans le cadre différentiel, la concentration des complexes biochimiques obtenues en permutant ces deux sites dans une ou plusieurs occurrences de cette protéine devrait être égales. En fait, ces quantités ne sont en pratique pas égales, mais plutôt proportionnelles. Pour mieux comprendre ce phénomène, nous pouvons étudier ce qui se passe dans un jeu de "pile" ou "face" avec deux pièces. Lorsque les deux pièces sont jetées, elles tombent toutes deux sur le côté "pile"  avec une probabilité un quart, toutes deux sur le côté "face" avec une probabilité un quart et l'une sur le côté "pile" et l'autre sur le côté "face"  avec une probabilité un demi. Pourtant il est possible d'intervertir les côtés "pile" et "face" d'une ou des deux pièces sans changer la nature du jeu. Les côtés "pile" et "face" ont donc un rôle symétrique. Pourtant les trois configurations ne sont pas équiprobables, en fait leur probabilité est proportionnelle au nombre de manière de retourner les pièces sans changer la configuration globale.  Ainsi, la configuration comportant les deux côtés "pile" et "face" reste inchangée lorsque les deux pièces sont retournées simultanément (c'est la seule manière non triviale de laisser cette configuration inchangée), alors qu'un tirage double est changé dès que l'on retourne au moins une des deux pièces, d'où un rapport de $2$ sur $1$ (en tenant compte de la transformation triviale qui consiste à ne changer aucune pièce). Ainsi, il faut tenir compte du nombre des transformations qui laissent un état ou un complexe biochimique inchangé pour connaître les rapports de proportionnalité entre les probabilités d'être dans deux états symétriques ou entre les concentrations de deux complexes symétriques.


Nous étudions maintenant l'importance des trois contraintes qui avaient été utilisées pour tester l'adéquation entre le modèle initial et le modèle simplifié. Ici, ces conditions doivent assurer, dans le cadre stochastique, que les probabilités d'être dans deux états obtenus en remplaçant une occurrence d'un type de dimère par une occurrence d'un autre type restent dans le même rapport de proportionnalité  au cours du temps. Dans le cadre différentiel, ces conditions doivent assurer que les concentrations entre les différentes sortes de dimères restent dans le même rapport de proportionnalité aux cours du temps. En Fig.~\ref{fig:proportion} est vérifié de manière empirique si de tels rapports de proportionnalité se manifestent pour plusieurs jeux de paramètres, que ce soit dans le cadre stochastique (colonne de gauche) ou différentiel (colonne de droite), en faisant varier la valeur des constantes de dissociations, la distribution initiale (ou l'état initial),
et les constantes d'association.
Dans le cadre stochastique, l'évolution de trois rapports est considéré~: le rapport entre l'état composé de quatre occurrences du monomère de la protéine \agent{A}{} et d'une occurrence du dimère symétrique \site{x}{}{}-\site{x}{}{} de la protéine \agent{A}{} et celui comprenant quatre occurrences du monomère de la protéine \agent{A}{} et une occurrence du dimère symétrique \site{y}{}{}-\site{y}{}{}~; le rapport entre l'état composé de quatre occurrences du  monomère de la protéine \agent{A}{} et d'une occurrence du dimère symétrique \site{x}{}{}-\site{x}{}{} de la protéine \agent{A}{} et celui comportant quatre occurrences du monomère de la protéine \agent{A}{} et une occurrence du dimère asymétrique de la protéine \agent{A}{} et le rapport entre l'état composé de deux occurrences du monomère de la protéine \agent{A}{} et de deux occurrences du dimère asymétrique de la protéine \agent{A}{} et celui formé de deux occurrences du monomère de la protéine \agent{A}{}, d'une occurrence de chacune des sortes de dimères symétriques de la protéine \agent{A}{}. Dans le cadre différentielle, est considérée l'évolution des rapports entre les concentrations des différentes sortes des dimères de la protéine \agent{A}{}.

\begin{figure*}[hp]
\hfill\subfigure[$\kxx=\kyy=1$,  $\kxy=\kdxx=\kdyy=\kdxy=2$ et $\probinitstate{\qone}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.13.1}}}
\end{center}
\end{minipage}}
\hfill
\subfigure[$\kxx=\kyy=1$,  $\kxy=\kdxx=\kdyy=\kdxy=2$, initialement $\conc{\pone}=6$ et  $\conc{\pxx}=\conc{\pxy}=\conc{\pyy}=0$.]
{\begin{minipage}{0.45\linewidth}
\label{figodeprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.13.1}}}
\end{center}
\end{minipage}}\hfill\mbox{}

\hfill\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=2$,  $\kdxy=4$ et $\probinitstate{\qone}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnotsymdissoprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.13.4}}}
\end{center}\end{minipage}}\hfill
\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=2$,  $\kdxy=4$,   initialement $\conc{\pone}=6$ sans dimère. ]%
{\begin{minipage}{0.45\linewidth}
\label{figodenotsymdissoprop}
\begin{center}{\scalebox{0.45}{\input{generated_pictures/ode.4.13.4}}}
\end{center}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=\kdxy=2$,
$\probinitstate{\qfive}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnotsyminitialprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.13.2}}}
\end{center}\end{minipage}}
\hfill
\subfigure[$\kxx=\kyy=1$, $\kxy=\kdxx=\kdyy=\kdxy=2$,
initialement $\conc{\pone}=\conc{\pxx}=2$ et $\conc{\pyy}=\conc{\pxy}=0$.]%
{\begin{minipage}{0.45\linewidth}
\label{figodenotsyminitialprop}\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.13.2}}}
\end{center}\end{minipage}}\hfill\mbox{}

\hfill\subfigure[$\kxx=1$, $\kyy=2$, $\kxy=4$,  $\kdxx=\kdyy=\kdxy=2$ et $\probinitstate{\qone}=1$.]%
{\begin{minipage}{0.45\linewidth}
\label{figctmcnotsymassoprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/sym.4.13.3}}}
\end{center}\end{minipage}}
\hfill
\subfigure[$\kxx=1$, $\kyy=2$, $\kxy=4$,  $\kdxx=\kdyy=\kdxy=2$ initialement $\conc{\pone}=6$ sans dimère.]%
{\begin{minipage}{0.45\linewidth}
\label{figodenotsymassoprop}
\begin{center}
{\scalebox{0.45}{\input{generated_pictures/ode.4.13.3}}}
\end{center}\end{minipage}}\hfill\mbox{}


\caption{Relations de proportionnalité dans le modèle initial.
 À gauche, évolution de rapports entre la probabilité d'être dans certains états pour différents paramètres cinétiques et différentes distributions d'états initiaux dans le système stochastique sous-jacent. À droite, évolution de rapports entre la concentration de différents complexes biochimiques  pour différents paramètres cinétiques et différentes concentrations initiales. }
\label{fig:proportion}
\end{figure*}


\begin{enumerate}
\item Dans le premier jeu de paramètres, les trois contraintes sont satisfaites. Les constantes
$\kxx$ et $\kyy$ sont fixées à $1$, alors que les constantes
$\kxy$, $\kdxx$, $\kdyy$ et $\kdxy$ sont fixées à $2$.
Le système stochastique sous-jacent débute de l'état formé de $6$ occurrences de la protéine \agent{A}{} sans lien, et le système différentiel de l'état où les monomères sont présent en concentration $6$, et les dimères absents. En Fig.~\ref{figctmcprop}, les courbes montrent de manière empirique que
la probabilité d'être dans l'état avec quatre occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de la protéine \agent{A}{} liées par leurs sites \site{x}{}{} est toujours la même que celle d'être dans l'état avec quatre occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de la protéine \agent{A}{} liées par leurs sites \site{y}{}{}. Par ailleurs, cette probabilité est toujours la moitié de celle d'être dans l'état avec quatre occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de la protéine \agent{A}{} liées par le site \site{x}{}{} de l'un et le site \site{y}{}{} de l'autre.
Ces rapports de proportionnalité correspondent à ceux déjà observer dans le jeu de "pile" ou "face".
Enfin, la probabilité d'être dans un état avec deux occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de dimères asymétriques est toujours deux fois plus grande que celle d'être dans un état avec deux occurrences de la protéine \agent{A}{} sous forme de monomère et d'une occurrence de chaque forme de dimère symétrique. Ce rapport s'explique que la formation d'un dimère asymétrique est deux fois plus probable que celle d'un type donnée de dimère symétrique (d'où un facteur $4$). Cependant, il faut diviser ce facteur par $2$, car deux dimères symétriques différents peuvent être obtenu en prenant le premier formé par une liaison entre deux sites \site{x}{}{} et le second entre deux sites \site{y}{}{}, ou l'inverse, soit deux fois plus de possibilités.

En ce qui concerne le comportement de la solution du système différentiel sous-jacent, les courbes en Fig.~\ref{figodeprop} montrent que les concentrations des deux sortes de dimère symétrique restent toujours égales, alors que la concentration en dimère asymétrique est toujours égale au double de cette valeur commune.

\item Dans le second jeu de paramètres,
la contrainte sur les constantes de dissociation est relachée.
Les constantes de dissociations sont ainsi fixées de manière arbitraire à $\kdxx=2$, $\kdyy=2$ et $\kdxy=4$.
Alors que les autres paramètres restent les mêmes que dans le premier jeu de paramètres.
Les courbes dessinées en Fig.~\ref{figctmcnotsymdissoprop} montrent que la probabilité d'être dans l'état avec quatre occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de la protéine \agent{A}{} liées par leurs sites \site{x}{}{} est toujours la même que celle d'être dans l'état avec quatre occurrences de la protéine \agent{A}{} sous forme de monomère et deux occurrences de la protéine \agent{A}{} liées par leurs sites \site{y}{}{}.
Par contre, les autres probabilités étudiées ne sont pas proportionnelles. Initialement, la probabilité d'être dans un état avec une occurrence du dimère asymétrique et quatre occurrences de la protéine \agent{A}{} sous la forme de monomère
est deux fois plus grande que celle d'être dans un état avec une occurrence du dimère asymétrique et quatre occurrences de la protéine \agent{A}{} sous la forme de monomère, mais ce rapport tends vers un avec le temps. D'autre part, la probabilité  d'être dans un état avec deux occurrences du dimère asymétrique et deux occurrences de la protéine \agent{A}{} sous la forme de monomère est deux fois plus grande au début que la probabilité d'être dans un état avec une occurrence de chacun des types de dimères symétriques et deux occurrences de la protéine \agent{A}{} sous la forme de monomère, mais ce rapport tends vers un demi avec le temps.
Dans le système différentiel, la concentration des deux types de dimère symétrique est toujours la même, alors que la concentration en dimère asymétrique est initialement deux fois plus grande, pour finalement converger vers cette même valeur.
En fait, les rapports initiaux sont dictés par les constantes d'association, ce sont les mêmes que pour le premier jeu de paramètres. En revanche, les rapports à la limite sont dictés par le rapport entre les constantes respectives d'association et de dissociation (et la répétition des occurrences du dimère asymétrique pour le facteur un demi additionel).

\item Dans le troisième jeu de paramètres, c'est la  distribution d'état initiale (dans le cadre stochastique) et  l'état initial (dans le cadre différentiel) qui sont fixés arbitrairement. Il n'y a de rapports de proportionnalité ni dans le cadre stochastique (voir en Fig.~\ref{figctmcnotsyminitialprop}), ni dans le cadre différentiel (voir en Fig.~\ref{figodenotsyminitialprop}).
Initialement, les rapports de probabilités et de concentrations sont imposés par les abondances au début de l'exécution des deux systèmes.
À la limite, l'impact du choix de la distribution initiale ou de l'état initial tend à disparaître et les rapports trouvés avec le premier jeu de paramètres resurgissent.

\item Enfin, le quatrième jeu de paramètres est obtenu
en fixant de manière arbitraire les constantes d'association.
Ceci a pour effet de déplacer les rapports de probabilités et les rapports de concentrations, qui sont maintenant fixé par les rapports entre les constantes de liaison et celles de dissociation(voir en Fig.~\ref{figctmcnotsymasso} et en Fig.~\ref{figodenotsymasso}).
\end{enumerate}


L'invariance de ces rapports de proportionnalité, pour certains jeux de paramètres est révélateur de la présence d'une relation de groupage faible. Celle-ci permet de quotienter l'exécution
d'une chaîne de Markov pour certaines distributions d'états initiales tout en restant Markovien \cite{buchholz94}.
De même, cela permet de réduire le système différentiel sous-jacent pour certains états initiaux.

Dans le cas du premier jeu de paramètres, le quotient opère même à plus bas-niveau, puisqu'il s'exprime au niveau réactionnel: à chaque réaction, peut être associée une réaction symétrique obtenue en échangeant les occurrences des sites \site{x}{}{} et \site{y}{}{} dans certaines occurrences de la protéine \agent{A}{}, ce qui permet de montrer l'existence d'une bisimulation arrière \cite{1347609} sur système de transition stochastique sous-jacent ou de réduire le système différentiel sous-jacent.

\subsection{Conclusion sur le cas d'étude}

Pour conclure avec cet exemple jouet, nous avons vu que des symétries pouvaient apparaître dans les complexes biochimiques, dans les états du système, dans les distribitions d'états ou même dans l'effet des règles. Ces symétries ont un impact sur notre capacité à réduire la dynamique du système. En effet, lorsque l'action des règles est symétrique, il est possible d'induire une relation d'équivalence pour quotienter l'ensemble des états, ce qui suggère l'existence d'une bisimulation avant. De plus, lorsque la distribution des états initiaux est également symétrique, alors le système non réduit comporte des invariants statistiques (le quotient entre la probabilité de deux états symétiques est égal à l'inverse du quotient de leur nombre d'automorphismes), ce qui suggère l'existence d'une bisimulation arrière. Contrairement aux raisonnements sur les rapport entre constantes de liaison et de dissociation, c'est un raisonnement compositionnel qui considère les réactions, classe de symétrie par classe de symétrie. C'est pourquoi ce type de raisonnement sera privilégié dans la suite de ce chapitre.

%\ignore
{%
\section{Group actions over rule-based models}

\label{sym-algebraic}




\begin{figure}[t]
\incgraphics[0.3\linewidth]{generated_pictures/sym_exa_left.pdf}
\begin{minipage}{0.3\linewidth}
\xymatrix@C=20mm@R=20mm{%
\ar@2@{<~>}^{\{2\}}[r]
& \\
\ar@2@{<~>}^{\{2\}}[r]
& \\
\ar@2@{<~>}^{\actionembactionlong{\{2\}}{f}={\{1\}}}[r]
& \\}
\end{minipage}
\incgraphics[0.3\linewidth]{generated_pictures/sym_exa_right.pdf}
\caption{An example of two symetric embeddings. We consider the embedding $f$ between the site graph $E \stackrel{\scriptscriptstyle \Delta}{=} \agent{A$_1$}{$\sitefont{y}_p$}$
and the site graph $F \stackrel{\scriptscriptstyle \Delta}{=} \agent{A$_2$}{$\sitefont{x}_u\sitesep\sitefont{y}_p$}$.
The permutation of sites   $\{2\}\in\groupset[F]$ swaps the state of the sites $\sitefont{x}$ and $\sitefont{y}$ in the unique agent of the site graph $F$. The permutation of sites  $\{2\}$ can also be restricted to the domain $E$ of the embedding $f$, which yields the permutation of sites  $\actionembactionlong{\{2\}}{f} \in \groupset[E]$, which is indeed equal to the permutation of sites  $\{1\}$ and that consists in replacing the site $\sitefont{y}$ into a site $\sitefont{x}$ (with the same internal state). The image $\actionembemblong{\{2\}}{f}$ of the embedding $f$ by the permutation of sites  $\{2\}$ is then the embedding mapping the unique agent of the image $\actiongraphlong{(\actionembactionlong{\{2\}}{f})}{E}$ of site graph $E$ by the permutation of sites  $\actionembactionlong{\{2\}}{f}$ into the unique agent of the image $\actiongraphlong{\{2\}}{F}$ of the site graph $F$ by the permutation of sites $\{2\}$.}
\label{fig:imageembedding}
\end{figure}



\newcommand{\groupsetlongbis}[1][]{((\groupsetbis[E],\tilde{\circ}_{E}),\tilde{\ldot},\tilde{\ldot}',\tilde{\ldot}'')}
\newcommand{\groupsetbis}[1][]{\tilde{\groupset}_{#1}}



\begin{example}[homogeneous permutations of sites]
\label{exmp:siteswapbis}
Fig.~\ref{fig:homogeneousorbit}.
\end{example}









\begin{figure*}[p]
\subfigure[With heterogenous permutations of sites $\groupsetone$, a transformation over the domain of an embedding can always be extended into a transformation over the image of this embedding.]{%
\begin{minipage}{0.45\linewidth}
\label{fig:for-example}
\incgraphics[\linewidth]{generated_pictures/sym_4_17a.pdf}

\vspace*{-5.2cm}

\hspace*{2.5cm}\textcolor{red}{$\permutbis$}

\vspace*{3.4cm}

\hspace*{2.5cm}$\permut$

\vspace*{0.5cm}\mbox{}
\end{minipage}}\hfill
\subfigure[With homogeneous permutations of sites $\groupsettwo$, it is not always possible to extend a transformation over the domain of an embedding into a transformation over the image of this embedding.]{%
\begin{minipage}{0.45\linewidth}
\label{fig:for-counter}
\incgraphics[\linewidth]{generated_pictures/sym_4_17b.pdf}

\vspace*{-5.2cm}

\hspace*{2.5cm}\textcolor{red}{$\permutbis$}

\vspace*{3.4cm}

\hspace*{2.5cm}$\permut$

\vspace*{0.5cm}\mbox{}
\end{minipage}}
\caption{An example of an embedding which is $\groupsetone$-compatible ({\ie}each heterogeneous permutation of sites, as defined  in Exa.~\ref{exmp:siteswap},  that can be applied to its domain can be extended into an heterogeneous permutation of sites that can be applied to its image), but not $\groupsettwo$-compatible ({\ie}there exists some homogeneous permutations of sites, as defined in Exa.~\ref{exmp:siteswapbis}). We take the site graph that is made of  two agents of type \agentfont{A} with a site \sitefont{x} unphosphorylated and a site \sitefont{y} phosphorylated, the embedding that adds a site \sitefont{z} to both of these agents and binds these two sites \sitefont{z} together,  hence merging the two connected components of the site graph, and the transformation that swaps the state of the sites \sitefont{x} and \sitefont{y} of the agent on the right.
With heterogeneous permutations of sites, permutations can be chosen independently for each agent, no matter they belong, or not, to the same connected component.
Thus, the transformation that is applied to the domain of the embedding can be extended into a transformation that can be applied to the image of the embedding, as shown in Fig.~\ref{fig:for-example}. With homogeneous permutations, for each connected components, the same permutation must be applied to all the agents with a same type in a that connected component. Since the two connected components of the initial site graphs have been merged,  it is no longer possible to swap the state of the sites \sitefont{x} and \sitefont{y} in the agent on the right, without  swapping those of the agent on the left. Thus it is impossible to extend the transformation that is applied to the domain of the embedding into a transformation that is applied to the image of the embedding, as shown in Fig.~\ref{fig:for-counter}.
}
\label{fig:for-example-counter-example}\end{figure*}
\begin{figure*}[p]
\subfigure[]{%
\begin{minipage}{0.45\linewidth}
\label{fig:for-exampleone}
\incgraphics[\linewidth]{generated_pictures/sym_4_17c.pdf}

\vspace*{-5.2cm}

\hspace*{2.5cm}\textcolor{red}{$\permutbis$}

\vspace*{3.4cm}

\hspace*{2.5cm}$\permut$

\vspace*{0.5cm}\mbox{}
\end{minipage}}\hfill
\subfigure[]{%
\begin{minipage}{0.45\linewidth}
\label{fig:for-exampletwo}
\incgraphics[\linewidth]{generated_pictures/sym_4_17d.pdf}

\vspace*{-5.2cm}

\hspace*{2.5cm}\textcolor{red}{$\permutbis$}

\vspace*{3.4cm}

\hspace*{2.5cm}$\permut$

\vspace*{0.5cm}\mbox{}
\end{minipage}}
\caption{An example of transformation that can be applied to the domain of an embedding and which can be extended into a transformation that can be applied to the image
of this embedding in various ways.  We consider a single agent of type \agentfont{A} with a site \sitefont{x} unphosphorylated and a site \sitefont{y} phosphorylated. We consider the transformation in $\groupsetone$ which consists in swapping the state of the sites \sitefont{x} and \sitefont{y} of the unique agent of this site graph.
Then we introduce  the embedding that adds a site \sitefont{z} to this agent and binds it to the site \sitefont{z} of a new agent of type \agentfont{A} also with the site \sitefont{x} unphosphorylated and the site \sitefont{y}Â phosphorylated.
When we extend the transformation to the image of the embedding, we have to swap the state of the sites \sitefont{x} and \sitefont{y} of the agent on the right, since it is the image of the unique agent of the domain of the embedding. But for the agent on the left, we are free to swap, or not, the state of these sites, which gives two potential extensions of the embedding: in Fig.~\ref{fig:for-exampleone}, we have swapped the states of the sites \sitefont{x} and \sitefont{y},Â whereas in Fig.~\ref{fig:for-exampletwo}, we leave them unchanged.}
\label{fig:twoways}
\end{figure*}



\subsubsection{Induced group action  over isomorphisms}

\paragraph{Applying transformations to isomorphisms}

The image of an isomorphism by a transformation within a valid set of transformations over site graphs, is an isomorphism as well.
Moreover, the image of an embedding by a transformation within a valid set of transformations over site graphs, is an isomorphism if and only if the former is an isomorphism as well.
This is expressed in the following property.


\paragraph{Applying transformations to automorphisms}
The image of an automorphism by a transformation within a valid set of transformations over site graphs, is an isomorphism but not necessarily an automorphism. Yet, the number of automorphisms of a site graph $E$ and the number of the site graphs that are both symetric and isomorphic to the site graph $E$ are closely related. Given two symetric site graphs $E$ and $\actiongraphlong{\sigma}{E}$, the product between the number of automorphisms of $E$ and the number of the site graphs that are both symetric and isomorphic to $E$, and the product between the number of automorphisms of $F$ and the number of the site graphs that are both symetric and isomorphic to $F$, are equal, as stated in the following proposition:
\begin{prop}
\label{countiso}Let $\groupset$ be a valid set of transformations over site graphs.
For any site graph $E$ and for any permutation $\sigma_E\in\groupset[E]$,
\begin{equation*}
\myfrac{\aut{E}}{\aut{\actiongraphlong{\sigma_E}{E}}} =
\myfrac{\card( [\actiongraphlong{\sigma_E}{E}]_\iso \cap [\actiongraphlong{\sigma}{E}]_{\groupequiv})}{\card([{E}]_\iso \cap [{E}]_{\groupequiv})}.
\end{equation*}
\end{prop}


As it was the case for site graphs,
the number of automorphisms of a rule $r$  and the number of rules in its orbit  that are isomorphic to the rule $r$ are related by the following proposition.
\begin{prop}
\label{countisorule}Let $\group$ be a valid set of transformations over site graphs.
For any rule $r$ and for any pair of permutations $\sigma\in\groupset[r]$,
\begin{equation*}
\myfrac{\symrules{r}}{\symrules{\actionembemblong{\sigma}{r}}} =
\myfrac{\card([\actionembemblong{\sigma}{r}]_\iso \cap [\actionembemblong{\sigma}{r}]_{\groupequiv})}{\card( [r]_\iso \cap [r]_{\groupequiv})},
\end{equation*}
for any rule $r'$, the value $\symrules{r'}$ denotes the number of automorphisms of the rule $r'$ (that is say the number of pairs of automorphisms $(h_L,h_R)$ such that the triple $(r',h_L,h_R)$ is a refinement of the rule $r'$).
\end{prop}







\newcommand{\sigmaLbis}{\sigma_{L'}}
\newcommand{\sigmaRbis}{\sigma_{R'}}
\newcommand{\sigmaDbis}{\actionembactionlong{f'}{\sigmaLbis}}
\newcommand{\newDbis}{\actiongraphlong{(\sigmaDbis)}{{h_D}}}
\newcommand{\newfbis}{\actionembemblong{\sigmaLbis}{f'}}
\newcommand{\newLbis}{\actiongraphlong{\sigmaLbis}{L'}}
\newcommand{\newRbis}{\actiongraphlong{\sigmaRbis}{R'}}
\newcommand{\newhL}{\actionembemblong{\sigmaLbis}{h_L}}
\newcommand{\newhD}{\actionembemblong{(\sigmaDbis)}{h_D}}
\newcommand{\newhR}{\actionembemblong{\sigmaRbis}{h_R}}
\newcommand{\sigmaL}{\actionembactionlong{\sigmaLbis}{h_L}}
\newcommand{\sigmaR}{\actionembactionlong{\sigmaRbis}{h_R}}
\newcommand{\sigmaD}{\actionembactionlong{(\sigmaDbis)}{h_D}}
\newcommand{\newL}{\actiongraphlong{(\sigmaL)}{L}}
\newcommand{\newR}{\actiongraphlong{(\sigmaR)}{R}}
\newcommand{\newr}{\actiongraphlong{(\sigmaL,\sigmaR)}{r}}
\newcommand{\newrbis}{\actiongraphlong{(\sigmaLbis,\sigmaRbis)}{r'}}


\section{Échanges de sites dans des graphes à sites} 

Pour rester simple, le cadre général ne sera pas décrit. Au lieu de cela, la présentation se concentre sur le cas particulier où les symétries prennent la forme d'échanges de sites. Le but de cette section est de définir l'effet de la permutation de sites dans les différents éléments du langage Kappa, c'est à dire les motifs, les plongements, les règles et l'application des règles.

Les échanges de sites forment un groupe. Ainsi il est possible de les composer et chaque échange de sites admet un échange inverse. De plus, ce groupe est engendré par les échanges entre deux sites (qui consistent à permuter l'état de deux sites dans l'occurrence d'une protéine). Aussi, seul l'effet des échanges entre deux sites sera décrit, l'effet des autres transformations pouvant être déduit en décomposant séquentiellement ces échanges élementaires de sites.



\newcommand{\sympatternm}[2]{\xymatrix@C=8mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_#2.pdf} \ar@[orange]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_op_#2.pdf}}}

\newcommand{\sympatternl}[2]{\xymatrix@C=8mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_#2.pdf} \ar@[green]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_op_#2.pdf}}}

\newcommand{\sympatternr}[2]{\xymatrix@C=8mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_#2.pdf} \ar@[red]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_#2_op.pdf}}}

\newcommand{\sympatternd}[2]{\xymatrix@C=8mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_#2.pdf} \ar@[brown]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_g#1_op_#2_op.pdf}}}

\newcommand{\symrulel}[2]{\xymatrix@C=20mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_id_id.pdf} \ar@[green]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_inv_id.pdf}}}

\newcommand{\symruler}[2]{\xymatrix@C=20mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_id_id.pdf} \ar@[red]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_id_inv.pdf}}}

\newcommand{\symruled}[2]{\xymatrix@C=20mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_id_id.pdf} \ar@[brown]@2@<3.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_4_2_#1_#2_inv_inv.pdf}}}

\subsection{Transposition de deux sites dans un complexe biochimique}


\begin{figure}[htp]

\hfill\subfigure[Transposition des sites dans les occurrences du monomère  de la protéine \agentfont{A}.]%
{\label{fig:trans:mono}%
\begin{minipage}{\linewidth}\hfill\sympatternm{}{Free_Free}\hfill\mbox{}\end{minipage}}%
\hfill\mbox{}

\hfill\subfigure[Transposition des sites de l'occurrence gauche de la protéine \agentfont{A} dans les occurrences de dimères de la protéine \agentfont{A}.]%
{\label{fig:trans:dimg}%
\sympatternl{sdimer}{x_x_Free_Free}%
\hspace*{2cm}\sympatternl{sdimer}{x_y_Free_Free}}%
\hfill\mbox{}

\hfill\subfigure[Transposition des sites de l'occurrence droite de la protéine \agentfont{A} dans les occurrences de dimères de la protéine \agentfont{A}.]%
{\label{fig:trans:dimd}%
\sympatternr{sdimer}{x_x_Free_Free}%
\hspace*{2cm}\sympatternr{sdimer}{x_y_Free_Free}}%
\hfill\mbox{}

\hfill\subfigure[Transposition des sites des deux occurrences de la protéine \agentfont{A} dans les occurrences de dimères de la protéine \agentfont{A}.]{%
\label{fig:trans:dimboth}%
\sympatternd{sdimer}{x_x_Free_Free}%
\hspace*{2cm}\sympatternd{sdimer}{x_y_Free_Free}}%
\hfill\mbox{}

\caption{Effet des échanges de sites sur les différentes formes de complexes biochimiques du modèle jouet.}
\label{fig:sym:complex}
\end{figure}


Il est possible d'échanger l'état de deux sites de la même occurrence d'un agent dans un complexe biochimique. Plutôt que d'échanger leurs états, il est possible de représenter duallement cette transformation en échangeant le nom des sites correspondants. Des exemples sont donnés en Fig.~\ref{fig:sym:complex}. Deux complexes biochimiques qui peuvent être obtenus l'un à partir de l'autre en permutant éventuellement des paires de sites dans une ou plusieurs occurrences de protéines, seront appelées \index{symétriques (complexes biochimiques)}{symétriques}\index{complexes biochimiques (symétriques)}.

\begin{example}
En Fig.~\ref{fig:sym:complex}, les échanges de sites sont appliqués aux complexes biochimiques de l'exemple étudiés dans ce chapitre (voir en Fig.~\ref{fig:chemicalspecies}). En Fig.~\ref{fig:trans:mono} est montré l'effet des échanges de sites sur les occurrences du monomère  de la protéine \agentfont{A}.
Il n'y a donc qu'un échange possible, puisqu'il n'y a qu'une occurrence de la protéine \agentfont{A}. Cet échange est dessiné en orange. Les deux sites de l'occurrence de la protéine \agentfont{A} sont nécessairement libres, sinon ce ne serait pas un monomère. Du coup, l'échange des deux sites laisse la configuration de ce complexe biochimique inchangée (puisqu'en effet la position des sites dans une occurrence de protéine n'a pas de signification particulière en Kappa).

Pour les occurrences de dimères de la protéine  \agent{A}{}, il est possible de permuter les sites de l'occurrence de gauche de la protéine \agent{A}{}, les sites de l'occurrence de droite \agent{A}{}, ou les deux.
En Fig.~\ref{fig:trans:dimg} est montré, en vert, l'effet de l'échange des sites de l'occurrence gauche de la protéine \agent{A}{}. En Fig.~\ref{fig:trans:dimd} est montré, en rouge, l'effet de l'échange des sites de l'occurrence droite de la protéine \agent{A}{}. Enfin en Fig.~\ref{fig:trans:dimboth} est montré, en marron, l'effet de la combinaison des deux échanges de sites. L'ordre n'a pas d'influence sur le résultat. L'échange des sites de deux occurrences de la protéine \agent{A}{} dans une occurrence du dimère asymétrique donne également une occurrence de dimère asymétrique, comme le montre la partie droite de la Fig.~\ref{fig:trans:dimboth}. Hormis ce cas particulier, l'application des échanges de sites aux autres configurations de complexes biochimiques les change. Essentiellement, les liaisons entre deux sites identiques deviennent des liaisons entre deux sites différents lorsque les sites sont échangés dans une seule occurrence de la protéine \agent{A}{}(voir en Figs.~\ref{fig:trans:dimg} et \ref{fig:trans:dimd}), alors que réciproquement, les liaisons entre deux sites différents deviennent des liaisons entre deux sites identiques (le site en question dépend de quel côté l'échange est appliqué). Lorsque les échanges de sites sont appliqués simultanément aux deux occurrences de la protéine \agent{A}{}(voir en Fig.~\ref{fig:trans:dimboth}), l'effet est de transformer un dimer formé par une liaison entre les deux sites \site{x}{}{} des occurrences de la protéine \agent{A}{} en un dimer formé par une liaison entre les deux sites \site{y}{}{} des occurrences de la protéine \agentfont{A}, et réciproquement.
\end{example}

\subsection{Transposition de deux sites dans un motif}


\begin{figure}[htp]

\subfigure[Transposition des sites sur les autres motifs avec une seule occurrence de la protéine \agentfont{A} partiellement définie.]{%
\label{fig:sym:motifs:a}%
\hspace*{2cm}{\sympatternm{}{None_None}}%
\hspace*{1cm}{\sympatternm{}{None_Free}}%
\hspace*{1cm}{\sympatternm{}{None_Bound}}%
\hspace*{1cm}{\sympatternm{}{Free_Bound}}%
%\hspace*{1cm}{\sympatternr{}{Bound_Bound}}%
\hspace*{2cm}\mbox{}}

\subfigure[Transposition des sites de l'occurrence gauche de la protéine \agentfont{A} dans les autres motifs formées de deux occurrences de la protéine \agentfont{A} partiellement définies.]%
{\label{fig:sym:motifs:b}\begin{minipage}{\linewidth}\hfill{\sympatternl{sdimer}{x_x_None_None}}%
\hspace*{2cm}{\sympatternl{sdimer}{x_y_None_None}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternl{sdimer}{x_x_None_Free}}%
\hspace*{2cm}{\sympatternl{sdimer}{x_y_None_Free}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternl{sdimer}{x_x_Free_None}}%
\hspace*{2cm}{\sympatternl{sdimer}{x_y_Free_None}}%
\hfill\mbox{} \bigskip\\
\end{minipage}}

\subfigure[Transposition des sites de l'occurrence droite de la protéine \agentfont{A} dans les autres motifs formées de deux occurrences de la protéine \agentfont{A} partiellement définies.]%
{\label{fig:sym:motifs:c}\begin{minipage}{\linewidth}\hfill{\sympatternr{sdimer}{x_x_None_None}}%
\hspace*{2cm}{\sympatternr{sdimer}{x_y_None_None}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternr{sdimer}{x_x_None_Free}}%
\hspace*{2cm}{\sympatternr{sdimer}{x_y_None_Free}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternr{sdimer}{x_x_Free_None}}%
\hspace*{2cm}{\sympatternr{sdimer}{x_y_Free_None}}%
\hfill\mbox{} \bigskip\\ \end{minipage}}

\subfigure[Transposition des sites des deux occurrences de la protéine \agentfont{A} dans les autres motifs formées de deux occurrences de la protéine \agentfont{A} partiellement définies.]%
{\label{fig:sym:motifs:d}\begin{minipage}{\linewidth}\hfill{\sympatternd{sdimer}{x_x_None_None}}%
\hspace*{2cm}{\sympatternd{sdimer}{x_y_None_None}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternd{sdimer}{x_x_None_Free}}%
\hspace*{2cm}{\sympatternd{sdimer}{x_y_None_Free}}%
\hfill\mbox{} \bigskip\\

\hfill{\sympatternd{sdimer}{x_x_Free_None}}%
\hspace*{2cm}{\sympatternd{sdimer}{x_y_Free_None}}%
\hfill\mbox{} \bigskip\\\end{minipage}

}
\caption{Effet des échanges de sites dans les motifs connexes qui ne sont pas des complexes biochimiques.}
\label{fig:sym:motifs}
\end{figure}

Il est possible d'échanger deux sites dans une occurrence de protéine dans un motif. Pour cela il suffit de choisir une occurrence de protéine dans un motif, et deux sites dans l'interface de la sorte de protéine correspondante.
Si l'occurrence de protéine ne contient aucun de ces deux sites, alors le motif reste tel qu'il est. Si l'occurrence de protéine contient exactement un des deux sites, alors celui-ci est remplacé par l'autre site en gardant ses éventuels états d'activation et de liaison. Enfin, si l'occurrence de protéine contient les deux sites, alors l'un est remplacé par l'autre, et réciproquement. De ce fait, les deux sites échangent leurs éventuels états d'activation et de liaison. Le motif reste inchangé si les deux sites avaient les mêmes états.
Deux motifs qui peuvent être obtenus l'un à partir de l'autre en échangeant éventuellement des paires de sites dans une ou plusieurs occurrences d'une protéine sont appelés \index{symétriques (motifs)}{motifs}\index{motifs symétriques}{} symétriques. On dit également que l'un est le symétrique de l'autre en précisant éventuellement par quels échanges de sites.

\begin{example}
L'effet des échanges de sites dans les occurrences des protéines des motifs connexes qui ne forment pas des complexes biochimiques (parce l'une de leur occurrence de la protéine \agent{A}{} y est partiellement définie) est décrit en Fig.~\ref{fig:sym:motifs}.


L'effet des échanges de sites dans les motifs formés d'une seule occurrence de la protéine \agent{A}{} est décrit en Fig.~\ref{fig:sym:motifs:a}. Les transformations correspondantes sont représentées par des doubles flèches  ondulées oranges. Permuter les sites \site{x}{}{} et \site{y}{}{} dans l'occurrence de la protéine \agent{A}{} dans un motif qui ne contient aucun site, laisse cette occurrence inchangée. Lorsqu'une occurrence de la protéine \agent{A}{} ne contient que le site \site{x}{}{}, son symétrique ne contient que le site \site{y}{}{} en préservant son état de liaison (qui peut être libre ou lié sans préciser à quel site) et réciproquement. Le cas d'une instance du monomère de la protéine \agent{A}{} dont les deux sites sont libres, a déjà été vu. En effet, c'est un complexe biochimique (voir en Fig.~\ref{fig:trans:mono}). Par ailleurs, il est impossible dans ce modèle de trouver une instance de la protéine \agent{A}{} avec ses deux sites liés, il reste donc uniquement le cas d'une instance de protéine avec deux sites, l'un libre, et l'autre lié à un site inconnu. Dans ce cas, échanger les sites revient à rendre libre le site qui était lié et lié celui qui était libre.

En Fig.~\ref{fig:sym:motifs:b}, sont représentés par des doubles flèches ondulées vertes l'échange des sites \sitefont{x}{}{} et \sitefont{y}{}{} dans l'occurrence de gauche de la protéine \agent{A}{} dans des motifs formés de deux occurrences de la protéine \agent{A}{} connectées entre elles. Les liens symétriques sont transformés en des liens asymétriques, et réciproquement (le type de lien étant défini par la site qui était lié dans l'occurrence de droite de la protéine \agent{A}{}). De plus, si le motif contenait un site libre, celui-ci est conservé mais change de nom s'il était situé dans l'occurrence de gauche de la protéine.

En Fig.~\ref{fig:sym:motifs:c}, sont représentés par des doubles flèches ondulées rouges l'échange des sites \sitefont{x}{}{} et \sitefont{y}{}{} dans l'occurrence de droite de la protéine \agent{A}{} dans des motifs formés de deux occurrences de la protéine \agent{A}{} connectées entre elles. Les liens symétriques sont transformés en des liens asymétriques, et réciproquement (le type de lien étant défini par la site qui était lié dans l'occurrence de droite de la protéine \agent{A}{}). De plus, si le motif contenait un site libre, celui-ci est conservé mais change de nom s'il était situé dans l'occurrence de gauche de la protéine.

En Fig.~\ref{fig:sym:motifs:d}, sont représentés par des doubles flèches marrons l'échange des sites \sitefont{x}{}{} et \sitefont{y}{}{} dans les deux occurrences de la protéine \agent{A}{} dans les motifs formés de deux occurrences de la protéine \agent{A}{} connectées entre elles. Les liens symétriques restent symétriques mais sont portés par l'autre site. Les liens asymétriques restent asymétriques (mais le rôle des deux occurrences de la protéine \agent{A}{} sont échangés). De plus, si le motif contenait un site libre, celui-ci est conservé mais change de nom tout en restant dans la même occurrence de la protéine \agent{A}{}.
\end{example}

\subsection{Application d'échanges de sites à un plongement}

L'application d'une règle repose sur l'existence d'un plongement du membre gauche de cette règle et le graphe représentant soit l'état du système, soit des complexes biochimiques à transformer. Pour raisonner sur les échanges de sites, nous avons donc besoin de définir le symétrique d'un plongement d'un motif dans un autre par un échange de sites.

Pour définir un échange de sites dans un plongement d'un motif source  dans un motif cible, nous choisissons un échange de sites à appliquer au motif cible. Ensuite, nous appliquons à chaque agent du motif source, le même échange de sites que celui qui a été appliqué à son image dans le motif cible. Ainsi, les échanges de sites qui s'appliquent à des agents du motif image sans antécédent n'ont pas d'effet sur le motif source.

Par construction, la correspondance entre les agents du motif source et ceux du motif cible est toujours valide dans leur symétrique. Du coup, cette correspondance induit  également un plongement entre le symétrique du motif source et le symétrique du motif cible. Nous appelons ce plongement le \index{symétriques (de  plongements)}{symétrique}\index{plongements (symétriques}{} du plongement initial par l'échange de sites en question. On dit alors que ces deux plongements sont symétriques.

\newcommand{\symembedmono}[3]{\xymatrix@C=15mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_embedding_mono_#1_#2_#3_id.pdf
} \ar@[brown]@2@<11.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_embedding_mono_#1_#2_#3_inv.pdf}}}


\begin{figure}[p]



\hfill\subfigure[Échange des sites dans les plongements vers les occurrences du monomère de la protéine \agentfont{A}.]%
{\label{fig:sym:plongement:a}%
{\begin{minipage}{\linewidth}%
\hfill\symembedmono{.}{Free}{Free}\hfill
\hfill\symembedmono{a..}{Free}{Free}\hfill
\hfill\symembedmono{ax.}{Free}{Free}\hfill\mbox{}

\hfill\symembedmono{a.y}{Free}{Free}\hfill
\hfill\symembedmono{identity}{Free}{Free}\hfill\mbox{}
\end{minipage}}}\hfill\mbox{}

\hfill\subfigure[Échange des sites dans les plongements vers le motif constitué d'une occurrence de la protéine \agentfont{A} avec le site \sitefont{x} lié et le site \sitefont{y} non documenté.]%
{\label{fig:sym:plongement:b}%
{\begin{minipage}{\linewidth}%
\hfill\symembedmono{.}{Bound}{None}\hfill
\hfill\symembedmono{a..}{Bound}{None}\hfill
\hfill\symembedmono{ax.}{Bound}{None}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}
\caption{Effet des échanges de sites sur les plongements vers des motifs consitutés d'une seule occurrence de la protéine \agentfont{A}.}
\label{fig:sym:plongement:mono}
\end{figure}

\newcommand{\symembeddim}[8]{\xymatrix@C=15mm@R=20mm{%
\incgraphics[0.4\linewidth]{generated_pictures/sym_embedding_dimer_#2_#3_#4_#5_#6_id_id.pdf
} \ar@[#1]@2@<11.7mm>@/_/@{<~>}[r]&\incgraphics[0.4\linewidth]{generated_pictures/sym_embedding_dimer_#2_#3_#4_#5_#6_#7_#8.pdf}}}

\newcommand{\symgroup}[3]{
\hfill \symembeddim{#1}{..}{Free}{None}{x}{x}{#2}{#3} \hfill\mbox\\

\hfill\symembeddim{#1}{a...}{Free}{None}{x}{x}{#2}{#3} \hfill\symembeddim{#1}{ax..}{Free}{None}{x}{x}{#2}{#3} \hfill\mbox\\

\hfill \symembeddim{#1}{a.y.}{Free}{None}{x}{x}{#2}{#3} \hfill \symembeddim{#1}{axy.}{Free}{None}{x}{x}{#2}{#3} \hfill\mbox\\

\hfill \symembeddim{#1}{.a..}{Free}{None}{x}{x}{#2}{#3} \hfill \symembeddim{#1}{.ax.}{Free}{None}{x}{x}{#2}{#3} \hfill\mbox\\


\hfill\symembeddim{#1}{ax.ax.}{Free}{None}{x}{x}{#2}{#3} \hfill\symembeddim{#1}{axyax.}{Free}{None}{x}{x}{#2}{#3} \hfill\mbox

}

\begin{figure}[htp]
\begin{minipage}{\linewidth}%

\symgroup{red}{inv}{id}

\end{minipage}
\caption{Effet de l'échange des sites de l'occurrence gauche de la protéine \agentfont{A} dans un plongement vers un motifs formé de deux occurrences de la protéine \agentfont{A}.}
\label{fig:trans:bingingd}
\end{figure}

\begin{figure}[htp]
\begin{minipage}{\linewidth}%
\symgroup{green}{id}{inv}
\end{minipage}
\caption{Effet de l'échange des sites de l'occurrence droite de la protéine \agentfont{A} dans un plongement vers un motifs formé de deux occurrences de la protéine \agentfont{A}.}
\label{fig:trans:bingingd}
\end{figure}

\begin{figure}[htp]
\begin{minipage}{\linewidth}%
\symgroup{orange}{inv}{inv}
\end{minipage}
\caption{Effet de l'échange des sites de chacune des occurrences de la protéine \agentfont{A} dans un plongement vers un motifs formé de deux occurrences de la protéine \agentfont{A}.}
\label{fig:trans:bingingboth}
\end{figure}


\begin{example}
Des exemples de plongements symétriques sont donnés en Fig.~\ref{fig:sym:plongement}.

\begin{itemize}
\item Le premier exemple décrit l'application de permutations de sites à l'identité d'un motif dans lui-même (voir en Fig.~\ref{fig:sym:plongement:a}). Les mêmes permutations de sites sont appliqués au motif cible et au motif source.
\item moins d'agent
\item moins de sites
\item image complete
\end{itemize}
\end{example}



\subsection{Effet d'un échange de sites sur une règle}


\begin{figure}[p]



\hfill\subfigure[Transposition des sites de l'occurrence gauche de la protéine \agentfont{A} dans les règles de liaison.]%
{\label{fig:trans:bingingg}%
{\begin{minipage}{\linewidth}%
\hfill\symrulel{asso}{a}\hfill\mbox{} \bigskip\\

\hfill\symrulel{asso}{b}\hfill\mbox{} \bigskip\\

\hfill\symrulel{asso}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\hfill\subfigure[Transposition des sites de l'occurrence droite de la protéine \agentfont{A} dans les règles de liaison.]%
{\label{fig:trans:bingingd}%
{\begin{minipage}{\linewidth}%
\hfill\symruler{asso}{a}\hfill\mbox{} \bigskip\\

\hfill\symruler{asso}{b}\hfill\mbox{} \bigskip\\

\hfill\symruler{asso}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\hfill\subfigure[Transposition des sites des deux occurrences de la protéine \agentfont{A} dans les règles de liaison.]%
{\label{fig:trans:bingingboth}%
{\begin{minipage}{\linewidth}%
\hfill\symruled{asso}{a}\hfill\mbox{} \bigskip\\

\hfill\symruled{asso}{b}\hfill\mbox{} \bigskip\\

\hfill\symruled{asso}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\caption{Effet des échanges de sites dans les règles de liaison  du modèle jouet.}
\label{fig:sym:binging_rule}
\end{figure}



\begin{figure}[p]



\hfill\subfigure[Transposition des sites de l'occurrence gauche de la protéine \agentfont{A} dans les règles de dissociation.]%
{\label{fig:trans:dissg}%
{\begin{minipage}{\linewidth}%
\hfill\symrulel{diss}{a}\hfill\mbox{} \bigskip\\

\hfill\symrulel{diss}{b}\hfill\mbox{} \bigskip\\

\hfill\symrulel{diss}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\hfill\subfigure[Transposition des sites de l'occurrence droite de la protéine \agentfont{A} dans les règles de liaison.]%
{\label{fig:trans:dissd}%
{\begin{minipage}{\linewidth}%
\hfill\symruler{diss}{a}\hfill\mbox{} \bigskip\\

\hfill\symruler{diss}{b}\hfill\mbox{} \bigskip\\

\hfill\symruler{diss}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\hfill\subfigure[Transposition des sites des deux occurrences de la protéine \agentfont{A} dans les règles de dissociation.]%
{\label{fig:trans:dissboth}%
{\begin{minipage}{\linewidth}%
\hfill\symruled{diss}{a}\hfill\mbox{} \bigskip\\

\hfill\symruled{diss}{b}\hfill\mbox{} \bigskip\\

\hfill\symruled{diss}{c}\hfill\mbox{} \bigskip\\

\end{minipage}}}\hfill\mbox{}

\caption{Effet des échanges de sites dans les règles de dissociation  du modèle jouet.}
\label{fig:sym:diss_rule}
\end{figure}

\subsection{Effet d'un échange de sites sur le raffinement d'une règle}




We are left to define the action of a permutation of sites over an embedding.
Since permutations of sites preserve the set of agents of the site graphs to which they are applied (only the set of sites and the states of these sites may change),
we can define the image of an embedding between two site graphs, as the embedding between the image of these two site graphs, that is induced by the same function over agents.


\begin{prop}
Let $h$ be an embedding between two site graphs $G$ and $H$.
Let $\sigma_H\in\symsymbol[H]$ be a permutation of the sites
of the site graph $H$.

The function between $\agents[G]$ and $\agents[H]$ that induces the embedding $h$, also induces an embedding between the site graph $\actiongraphlong{(\actionembactionlong{\sigma_H}{h})}{G}$ and the site graph $\actiongraphlong{\sigma_H}{H}$.
\end{prop}


\begin{definition}[action of a permutation over an embedding]
\label{actionemb}
Let $h$ be an embedding between two site graphs $G$ and $H$.
Let $\sigma_H\in\symsymbol[{\type[H]}]$ be a permutation of the sites
of the graph $H$.

We define $\actionembemblong{\sigma_H}{h}$ as the embedding between the site graph $\actiongraphlong{(\actionembactionlong{\sigma_H}{h})}{G}$ and $\actiongraphlong{\sigma_H}{H}$ that is induced by the same function between $\agents[G]$ and the site graph $\agents[H]$ as $h$.
\end{definition}


Now we give more details about the example in Fig.~\ref{fig:propperm}.

\begin{example}
\label{example:permutations:embedding}We illustrate Defs.~\ref{permutation propagation} and \ref{actionemb} in Fig.~\ref{fig:propperm}. The signature is the same as in Ex.~\ref{exampleofpermutations}: there are two kinds of agents $A$ and $B$. The agents of type $A$ have three binding sites $x$, $y$ and $z$, while the agents of type $B$ have three binding sites $u$, $v$, $w$.

We consider an embedding $h$ between two site graphs $G$ and $H$, where:
\begin{enumerate}
\item the site graph $G$ is made of an agent $1$ of type $A$ in which the site $x$ is bound (with no further information), the site $y$ is free, and we have no information about the binding state of the site $z$.
\item the site graph $H$ is made of two agents: the agent $2$ of type $A$ and the agent $3$ of type $B$. The site $y$ of the agent $2$ and the site $v$ of the agent $3$ are free. There is a link between the site $x$ of the agent $2$ and the site $w$ of the agent $1$ and another link between the site $z$ of the agent $2$ and the site $u$ of the agent $3$.
\item the embedding $h$ maps the agent of the site graph $G$ to the agent $2$ of the site graph $H$.
\end{enumerate}
We consider the permutation of sites $\sigma_3\in\symsymbol[H]$ that is defined as $\sigma_3\bydef (f_n)_{n\in\{2,3\}}$ where:
\begin{itemize}
\item $f_2 = [x\mapsto z, y\mapsto y, z\mapsto x]$;
\item $f_3 = [u\mapsto v, v\mapsto u, w\mapsto w]$.
\end{itemize}
Thus the action of the permutation of sites  $\sigma_3$ on the site graph $G$ swaps the states of the sites $x$ and $z$ in agent $2$ and the states of the sites $u$ and $v$ in agent $3$. As a result the site $y$ of the agent $2$ and the site $u$ of the agent $3$ become free. The site $x$ of agent $2$ and the site $v$ of the agent $3$ are now bound together, as well as  the site $z$ of the agent $2$ and the site $w$ of the agent $3$.

The permutation of sites $\sigma_3$ can be restricted to the domain of the embedding $h$.
By Def.~\ref{actionemb}, the resulting permutation of sites $\actionembactionlong{\sigma_3}{h}$ is the permutation in $\symsymbol[G]$ that is defined by $\actionembactionlong{\sigma_3}{h}=(f'_1)$ where:
\begin{equation*}
f'_1 = f_{h{(1)}}.
\end{equation*}
It follows that:
\begin{equation*}
f'_1 = [x\mapsto z, y\mapsto y,z\mapsto x].
\end{equation*}
Thus, the permutation of sites $\actionembactionlong{\sigma_3}{h}$ swaps the states of the site $x$ and $z$ in the unique agent of the site graph $G$.
It follows that in the unique agent of the site graph $\actiongraphlong{(\actionembactionlong{\sigma_3}{h})}{G}$, the binding state of the site $x$ is not specified, the site $y$ is free, and the site $z$ is bound (with no further information). We can check that the embedding $\actionembemblong{\sigma_3}{h}$ embeds the site graph
$\actiongraphlong{(\actionembactionlong{\sigma_3}{h})}{G}$ into the site graph $\actiongraphlong{\sigma_3}{H}$.
\end{example}

\begin{prop}
The tuple $\symsymbol[]=((\symsymbol[G]),\ldot,\ldot',\ldot'')$ is a valid set of transformations  over site graphs (as defined in Defs.~\ref{defn:permutation} and \ref{def:validpermutation}).

Moreover each embedding is $\symsymbol[]$-compatible (as defined in Def.~\ref{def:compatible}).
\end{prop}

\newcommand{\Rxu}{$\agent{A$_1$}{$\sitefont{x}_u$}$}
\newcommand{\Rxp}{$\agent{A$_1$}{$\sitefont{x}_p$}$}
\newcommand{\Ryu}{$\agent{A$_1$}{$\sitefont{y}_u$}$}
\newcommand{\Ryp}{$\agent{A$_1$}{$\sitefont{y}_p$}$}
\newcommand{\Rpp}{$\agent{A$_1$}{$\sitefont{x}_p\sitesep\sitefont{y}_p$}$}

\newcommand{\Ax}[1]{$\agent{A$_{#1}$}{$\sitefont{x}$}$}
\newcommand{\Ay}[1]{$\agent{A$_{#1}$}{$\sitefont{y}$}$}
\newcommand{\AAxx}{$\agent{A$_1$}{$\sitefont{x}^{\agent{A$_2$}{}@x}$}\agentsep\agent{A$_2$}{$\sitefont{x}^{\agent{A$_1$}{}@x}$}$}
\newcommand{\AAyy}{$\agent{A$_1$}{$\sitefont{y}^{\agent{A$_2$}{}@y}$}\agentsep\agent{A$_2$}{$\sitefont{y}^{\agent{A$_1$}{}@y}$}$}
\newcommand{\AAxy}{$\agent{A$_1$}{$\sitefont{x}^{\agent{A$_2$}{}@y}$}\agentsep\agent{A$_2$}{$\sitefont{y}^{\agent{A$_1$}{}@x}$}$}
\newcommand{\AAyx}{$\agent{A$_1$}{$\sitefont{y}^{\agent{A$_2$}{}@x}$}\agentsep\agent{A$_2$}{$\sitefont{x}^{\agent{A$_1$}{}@y}$}$}
\begin{figure}[t]
\subfigure[$r_1$\;:\;\Ax{1}\agentsep\Ax{2}$\;\kapparule{}\;$\AAxx $\;@k_1$]
{\label{rulesym212}\incgraphics[\linewidth]{generated_pictures/sym_4_2_a_id_id.pdf}}

\subfigure[$r_2$\;:\;\Ay{1}\agentsep\Ay{2}$\;\kapparule{}\;$\AAyy $\;@k_2$]%
{\label{rulesym222}\incgraphics[\linewidth]{generated_pictures/sym_4_2_b_id_id.pdf}}

\subfigure[$r_3$\;:\;\Ax{1}\agentsep\Ay{1}$\;\kapparule{}\;$\AAxy $\;@k_3$]%
{\label{rulesym232}\incgraphics[\linewidth]{generated_pictures/sym_4_2_c_id_id.pdf}}

%\subfigure[$r'_3$\;:\;\Ay{1}\agentsep\Ax{1}$\;\kapparule{}\;$\AAyx $\;@k'_3$]%
%{\label{rulesym242}\incgraphics[\linewidth]{generated_pictures/sym_4_2_d_id_id.pdf}}
\caption{Under which conditions are the sites $x$ and $y$ equivalent in each occurrence of the protein \agentfont{A}{} ?}
\end{figure}


\subsection{Retour sur le cas d'étude}

Pour conclure ce chapitre, cette approche est appliquée sur le modèle jouet qui avait été introduit Sec.~\ref{sec:modele} page \pageref{sec:modele}.

\newcommand{\orbit}[5]{%
\xymatrix@C=0mm@R=#5mm{%
& \begin{minipage}{#1}\incbox{#2}{#3}{generated_pictures/#4_id_id.pdf}\end{minipage}\ar@[green]@2@/_{1.5cm}/@{<~>}[dl]\ar@[red]@2@/^{1.5cm}/@{<~>}[dr]\ar@[brown]@2@/^{0.5cm}/@{<~>}[dd] & \cr
\begin{minipage}[b]{#1}\incbox{#2}{#3}{generated_pictures/#4_inv_id.pdf}\end{minipage}\ar@[red]@2@/_{1.5cm}/@{<~>}[dr]\ar@[brown]@2@/^{0.5cm}/@{<~>}[rr] & &
\begin{minipage}[t]{#1}\incbox{#2}{#3}{generated_pictures/#4_id_inv.pdf}\end{minipage}\ar@[green]@2@/^{1.5cm}/@{<~>}[dl] \cr
&\begin{minipage}{#1}\incbox{#2}{#3}{generated_pictures/#4_inv_inv.pdf}\end{minipage}}}

\newcommand{\orbitrules}[1]{\orbit{5cm}{23.6mm}{165.5mm}{sym_4_2_#1_a}{15}}

\begin{figure*}
\subfigure[Les règles d'association sous forme d'orbite.]%
{\label{fig:orbit:asso}\orbitrules{asso}}


\subfigure[Les règles de dissociation sous forme d'orbite.]%
{\label{fig:orbit:disso}\orbitrules{diss}}

\caption{Quitte à permuter les sites \sitefont{x}{}{} et \sitefont{y}{}{} dans certaines occurrences de la protéine \agent{A}{}, les règles peuvent être regroupées en deux catégories. Les règles d'association sont représentées en Fig.~\ref{fig:orbit:asso}, alors que les règles de dissociation sont représentées en Fig.~\ref{fig:orbit:disso}. L'effet des permutations de sites est représenté par des doubles flèches ondulées. Les permutations triviales, qui consiste à ne rien changer ne sont pas représentées. La permutation des sites \sitefont{x}{}{} et \sitefont{y}{}{} dans l'occurrence gauche de la protéine est représentée en vert~; celle dans l'occurrence de droite est représentée en rouge~; la permutation simultannée des sites \sitefont{x} et \sitefont{y} dans les deux occurrences de la protéine \agentfont{A} est représentée en marron.}
\label{fig:rule:orbits}
\end{figure*}


\begin{figure*}[t]
\hfill\subfigure[Orbite des occurrences du monomère de la protéine \agent{A}{}.]%
{\label{fig:orbit:mono}%
\begin{minipage}{0.4\linewidth}%
\hfill\xymatrix@C=20mm@R=20mm{\incbox{1cm}{1cm}{generated_pictures/sym_4_1_a.pdf}\ar@[orange]@2@/_{1.cm}/@{~>}[d]\cr\incbox{1cm}{1cm}{generated_pictures/sym_4_1_a_op.pdf}\ar@[orange]@2@/_{1.cm}/@{~>}[u]}\hfill\mbox{}\end{minipage}}
\hfill\subfigure[Orbite des occurrences de dimère.]%
{\label{fig:orbit:dimer}%
\begin{minipage}{0.59\linewidth}
\orbit{2cm}{23.6mm}{65.6mm}{sym_4_2_dimer_a}{10}\end{minipage}}\hfill\mbox{}
\caption{Quitte à permuter les sites \sitefont{x} et \sitefont{y} dans les occurrences de la protéine \agentfont{A}, les complexes biochimiques se classent en deux catégories, les monomères (voir en Fig.~\ref{fig:orbit:mono}) et les dimères (voir en Fig.~\ref{fig:orbit:dimer}).
Pour les monomères, la seule transformation possible consiste à permuter les sites de l'unique occurrence de la protéine (ce qui est dessiné avec une double flèche ondulée orange). Ceci ne change par la conformation de la protéine puisque l'ordre des sites n'a pas d'importance dans le langage Kappa. Pour les dimères, le rôle des sites peuvent être échangés dans l'occurrence gauche (ce qui est dessiné avec une double flèche ondulée verte), dans l'occurrence droite (rouge) ou dans les deux simultanément (noire). Quite à changer l'ordre des agents et des sites de liaisons, les deux représentations graphiques des dimères asymétriques sont équivalentes du point de vue de la sémantique du langage Kappa.}
\label{fig:orbit:complex}
\end{figure*}


Dans ce modèle, quite à intervertir les sites \site{x}{}{} et \site{y}{}{} dans une ou plusieurs occurrences de la protéine \agent{A}{}, les règles se répartissent  en deux catégories~:
les règles d'association et les règles de dissociation. Ces deux catégories sont dessinées en Fig.~\ref{fig:rule:orbits}, ainsi que les permutations de sites qui permettent de passer d'une règle à une autre au sein de chaque catégorie.
%Les doubles flèches ondulées vertes représentent la permutation des sites \site{x}{}{} et \site{y}{}{} dans l'occurrence gauche de la protéine \agent{A}{}~; les doubles flèches ondulées rouges représentent la permutation des sites \site{x}{}{} et \site{y}{}{} dans l'occurrence droite de la protéine \agent{A}{} et  les doubles flèches ondulées noires représentent la permutation des sites \site{x}{}{} et \site{y}{}{} dans les deux occurrences de la protéine \agent{A}{} à la fois.
Dans chacune des ces deux catégories, deux règles
correspondent à la même, quite à échanger le rôle des deux occurrences de la protéine \agent{A}{}. Il s'agit des deux règles d'association  asymétrique pour lier le site \site{x}{}{} d'une des occurrences de la protéine \agent{A}{} au site \site{y}{}{} de l'autre occurrence de la protéine \agent{A}{} (les deux règles sur la ligne du milieu en Fig.~\ref{fig:orbit:asso}) et des deux règles de dissociation asymétriques
(les deux règles sur la ligne du milieu en Fig.~\ref{fig:orbit:disso}). Ainsi, pour que les sites \site{x}{}{} et \site{y}{}{} aient un rôle équivalent dans le modèle, il suffit que
les constantes corrigées des quatre règles d'association soient égales et que celles des quatre règles de dissociation le soient également. Ainsi, en tenant compte, du coefficient de correction des constantes de réaction  et des répétitions des règles au sein de chaque catégorie de règles, cela donne les contraintes suivantes~:
\begin{equation*}
\myfrac{\kxx}{2\cdot{1}}=\myfrac{\kyy}{2\cdot{1}}=\myfrac{\kxy}{2\cdot{2}}
\end{equation*}
et
\begin{equation*}
\myfrac{\kxx}{2\cdot{1}}=\myfrac{\kyy}{2\cdot{1}}=\myfrac{\kxy}{1\cdot{2}}.
\end{equation*}
Dans ces fractions, le premier facteur des dénominateurs représente la correction des constantes de réaction  alors que le deuxième facteur correspond au nombre de formes de la règle (modulo permutation des agents) qui apparaissent dans les catégories de règles.

Il s'en suit les contraintes suivantes:
\begin{equation*}
\begin{cases}
\kxx=\kyy \cr
\kxy=2\kxx \cr
\kdxx=\kdyy \cr
\kdxx=\kdxy\cr
\end{cases}
\end{equation*}

Sous ces conditions, les sites \site{x}{}{} et \site{y}{}{} sont équivalents, ce qui induit une bisimulation dans les deux sens sur à la fois sur le systèmes stochastique sous-jacent et le système différentiel sous-jacent.

Cette bisimulation permet de réduire ces systèmes en oubliant la différence entre les sites \site{x}{}{} et \site{y}{}{}, et ce quel que soit la distribution initiale des états (dans le cadre stochastique) ou les concentrations initiales (dans le cadre différentiel).

Par ailleurs, cette bisimulation permet de caractériser des sous-espaces de distributions d'états (dans le cadre stochastique) et des sous-espaces de concentrations (dans le cas différentiel) stables.

L'examen des différents complexes et de leur relation vis à vis des permutations de sites équivalent permet de trouver un sous-espace stable de concentrations. Quitte à permuter l'état des sites \site{x}{}{} et \site{y}{}{} dans une ou plusieurs occurrences de la protéine \agent{A}{}, l'ensemble de tous les complexes biochimiques du modèle jouet se classe en deux catégories~: les monomères et les dimères. Celles-ci sont redessinées  en Fig.~\ref{fig:orbit:complex} sous la forme de deux orbites.
Les permutations qui permettent de passer d'un complexe biochimique à un autre au sein de chaque catégorie sont représentées par des doubles flèches ondulées.
Plutôt que d'intervertir l'état des sites, l'action de ses permutations a été représenté en échangeant, de manière équivalente, les sites.
%Les permutations qui consistent à intervertir les sites \site{x}{}{} et \site{y}{}{} dans l'unique occurrence de la protéine \agent{A}{} d'un monomère sont représentées en orange.
%Les permutations qui consistent à intervertir les sites \site{x}{}{} et \site{y}{}{} dans l'occurrence de gauche de la protéine \agent{A}{} dans un dimère sont représentées en vert, celles pour l'occurrence de gauche en rouge, et enfin les permutations qui intervertissent simultanément les sites \site{x}{}{} et \site{y}{}{} dans les deux occurrences de la protéine \agent{A}{} dans un dimère sont représentées en marron.
Étant donné que l'ordre des sites dans une occurrence de protéine n'a pas de signification particulière en Kappa, il existe une seule forme de monomère. Leur concentration n'est  donc pas contrainte dans le sous-espace stable de concentrations qui découle de l'équivalence entre les sites \site{x}{}{} et \site{y}{}{} dans les occurrences de la protéine \agent{A}{}. Il existe en revanche trois formes de dimères~: les dimères symétriques avec une liaison entre deux sites \site{x}{}{}~; les dimères symétriques avec une liaison entre deux sites \site{y}{}{} et les dimères asymétriques avec une liaison entre un site \site{x}{}{} d'une occurrence de la protéine \agent{A}{} et le site \site{y}{}{} d'une autre occurrence de la protéine \agent{A}{}.
Quitte à échanger le rôle des deux occurrences des protéines \agent{A}{}, cette dernière forme de dimère apparaît deux fois. En conséquence, le sous-espace stable de concentrations qui découle de l'équivalence entre les sites \site{x}{}{} et \site{y}{}{} doit satisfaire les contraintes suivantes~: les dimères asymétriques doivent constituer la moitié de la concentration totale en dimère et chacune des deux formes de dimère symétrique doit constituer un quart de la concentration totale en dimère. Il s'agit des mêmes proportions que pour le jeu de "pile" ou "face".



Dans le cadre stochastique, il faut regarder, pour déduire  un sous-espace de distributions stable, les catégories d'états du système. Quite à permuter l'état des sites \site{x}{}{} et \site{y}{}{}, dans une ou plusieurs occurrences de la protéine \agent{A}{}, deux états sont équivalents s'ils contiennent le même nombre d'occurrences du monomère de la protéine \agent{A}{} et le même nombre total d'occurrences de ses trois dimères.

Reprenant la notation $\state{i,j,k,l}$ pour désigner un état avec $i$ occurrences du monomère, $j$ occurrences du dimère formé d'une liaison entre deux sites \site{x}{}{}, $k$ occurrences du dimère formé d'une liaison entre deux sites \site{y}{}{} et $l$ occurrences du dimère formé d'une liaison entre le site \site{x}{}{} d'une occurrence de la protéine \agent{A}{} et le site \site{y}{}{} d'une autre occurrence de la protéine \agent{A}{}, deux états $\state{i',j',k',l'}$ et
$\state{i'',j'',k'',l''}$ sont donc équivalents losque $i'=i''$ et $j'+k'+l'=j''+k''+l''$. Reste à calculer les rapports de proportionnalité entre les probabilités de deux tels états dans le sous espace de distributions stable défini par l'équivalence entre les sites \site{x}{}{} et \site{y}{}{}.



\section{Benchmarks}
\label{sec:benchmark}


\begin{figure}[t]
\hspace*{1.cm}\begin{minipage}{\linewidth}
  {%
    \scalebox{0.9}{\centering\begin{tabular}{|c|c|c|c|c|c|c|}
  \hline
    \multirow{2}{*}{model} & \multirow{2}{*}{\;sites\;} &
      \multirow{2}{*}{\;rules\;} & \multicolumn{2}{c|}{species} & \multicolumn{2}{c|}{reactions}  \\\cline{4-7}
  & & & original & reduced & original & reduced \\
  \hline
  kinase/phosphatase & $n$ & $6n$ & $2+4^n$ & \;$2+\left( {}^{n+3}_{\;\;3\;\;}\right)\;$ & $6n4^{n-1}$ & $2n\left({}^{n+2}_{\;\;2\;\;}\right)$
  \\
  multiple phosphorylation & $n$ & $n2^n$ & $2^n$ & $n+1$ & $n2^n$ & \;$2n$\; \cr
  mult. phosphoryl. with counter & $n$ & $2n^2$ & $2^n$ & $n+1$ & $n2^n$ & $2n$ \cr
  \hline
\end{tabular}}
  }
  \end{minipage}
\caption{Key attributes of our models with respect to the parameter $n$.}
\label{fig:key:attributes}
\end{figure}

\begin{figure}[t]
\begin{minipage}{0.55\linewidth}
\subfigure[kinetase/phosphatase model.]{%
\begin{minipage}{\linewidth}
\centering\scalebox{0.435}{\includegraphics[width=320px]{generated_pictures/kin_phos.png}}
\end{minipage}}
\end{minipage}
\begin{minipage}{0.45\linewidth}
\subfigure[multi-phosphorylation site model.]{%
\begin{minipage}{\linewidth}
\centering\scalebox{0.435}{\includegraphics[width=320px]{generated_pictures/multi_phos.png}}
\end{minipage}}
\end{minipage}

\vspace*{-2mm}

\begin{minipage}{0.6\linewidth}
\subfigure[multi-phosphorylation site model with counter.]{%
\begin{minipage}{\linewidth}
\centering\hspace*{-0.1\linewidth}\scalebox{0.435}{\includegraphics[width=320px]{generated_pictures/multi_phos_with_counter.png}}
\end{minipage}}
\end{minipage}
\begin{minipage}{0.4\linewidth}
\vspace*{-1mm}

\hspace*{-20px}
\subfigure[legend.]{%
\begin{minipage}{\linewidth}
\centering\hspace*{-20px}\scalebox{0.435}{\includegraphics[width=360px]{generated_pictures/legend.png}}
\end{minipage}}
\end{minipage}


\caption{Comparison between the time performances of {\kade}, {\BNGL}, and {\erode}, on a MacBookPro with a \texttt{2,8 GHz Intel Core i7} CPU and a \texttt{16 Go 1600 MHz DDR3} memory and with a $10$ minutes time-out.  %\textbf{\emph{Ground reactions}}: we plot the CPU time for generating reaction networks with {\kade}  and with {\BNGL}. \textbf{\emph{Symmetries analysis}}: we plot the total time to compute the sets of equivalence sites (both in forward and in backward bisimulation modes) with {\kade}. \textbf{\emph{Model reduction}}: we plot the time to compute reduced networks with {\kade}, {\BNGL}, and {\erode}, starting from the unreduced network.  \textbf{\emph{Further reduction}}: we plot the CPU-time on running {\erode} on the reduced networks computed by {\kade}.
}
\label{fig:benchmarks}
\end{figure}


We test the reduction power and the time efficiency of our framework on three families of models offering  various conditions about the ratio of the number of Kappa rules to the number of reactions and about the ratio of the number of different bio-molecular species configurations to the number of their equivalence classes. In {\kade}, the computation time for generating networks (or ODEs) depends mainly on the number of rules and the number of equivalence classes of bio-molecular species configurations. The data-structure described in \cite{DBLP:conf/esop/BoutillierEK17} is used to generate reactions efficiently.  More examples, including most of the {\BNGL} test suite, are provided in Supplementary Information \cite{SI}.

The first family involves a kinase, a phosphatase, and a target protein. The target protein has $n$ sites ($n$ is left as a parameter).
The kinase may bind and unbind to each non-phosphorylated site of the target protein. The kinase may phosphorylate a site when releasing it.
Conversely, the phosphatase may bind and unbind to each phosphorylated site of the target protein. The phosphatase may also dephosphorylate a site when releasing it. We assume that every site has the same mechanistic properties and that the rate of reactions does not depend on the state of the other sites in the target protein.

%\item
The second and third families of models are inspired by the protein Kai. This protein plays a crucial role in the control of the circadian clock oscillations.  We consider a protein with $n$ sites ($n$ is left as a parameter) which may each be phosphorylated, or not.
The kinase and the phosphatase are not described explicitly.
We assume that the rate constants of phosphoralylation (resp.~dephosphorylation) of a site in a protein depend on the number of sites that are already phosphorylated in this protein.
%The second and the third families of models are the same, except that
In the third family of models, a trick suggested by Pierre Boutillier is used to reduce drastically the number of rules that are required to describe the models. %This trick has been proposed by Pierre Boutillier.
We use a fictitious site that is bound to a chain of fictitious proteins the length of which encodes the number of phosphorylated sites.
When a site is phosphorylated, a new protein is inserted in the chain and removed when a site gets dephosphorylated. Thus the phosphorylation level of a protein can be checked by looking at the length of this chain, without having to enumerate the different combinations fot the sites that are phosphorylated.

In Fig.~\ref{fig:key:attributes}, we give the number of rules, species and reactions, for each family of models for the parameter $n$ ranging from $1$ to $10$, as well as the number of reactions and species when equivalent sites are considered. In Fig.~\ref{fig:benchmarks}, we compare
the computation time to generate the original and the reduced networks with {\BNGL} and {\kade}. The generation of reduced models with  {{\kade}} (which does not require explicit annotation of equivalent sites) is  much faster than the one of the unreduced networks.
%give the computation time to compute the original (unreduced) network and both reduced networks by forward bisimulation and  by backward bisimulation.with {\kade}.
%run {\kade} to compute the original (unreduced) network, the networks reduced by forward bisimulation and  by backward bisimulation.
%We compare with the {\BNGL} network generation time, starting with both  versions of the model (with/without the equivalent sites specified explicitly).
{\kade} and {\BNGL} generate exactly the same reduced networks.
 Lastly, we apply the fast version of {\erode}
of the bisimulation inference algorithm  \cite{TACAS2016}
on the original networks and the complete version on the reduced ones  \cite{DBLP:conf/concur/CardelliTTV15}.
 But we found not further reduction this way.
% followed by the reduction with {{\erode}}.
In \cite{SI}, we observe as good results on the {\BNGL} test suite.




%\findechapitre
%%% Local Variables:
%%% ispell-local-dictionary: "french"
%%% End:
